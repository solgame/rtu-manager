<!DOCTYPE HTML>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RTU í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ (Firebase + í…ŒìŠ¤íŠ¸ ë°ì´í„° í¬í•¨)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background:#f3f4f6; }
    .thumb { width:96px; height:72px; object-fit:cover; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.08); }
    .hidden-file { position:absolute; left:-9999px; }
    .modal-bg { background: rgba(17,24,39,0.6); }
    .tab-active { border-color: #3b82f6 !important; color: #3b82f6; font-weight: 600; }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-6xl mx-auto p-4 sm:p-8">
    <div class="bg-white rounded-2xl shadow-xl p-6">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b pb-4 mb-4">
        <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">RTU í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        <div class="flex items-center space-x-3 mt-4 sm:mt-0">
             <label for="csv-upload" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-full hover:bg-blue-700 transition duration-150 text-sm cursor-pointer">
                CSV ì—…ë¡œë“œ
            </label>
            <input type="file" id="csv-upload" accept=".csv" multiple class="hidden-file" onchange="handleDataUpload(event)">

            <button id="download-data-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-full hover:bg-gray-300 transition duration-150 text-sm" onclick="exportAllCSV()">ë°ì´í„° CSV ë‹¤ìš´ë¡œë“œ</button>
        </div>
      </div>

      <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
          <button class="tab-btn tab-active border-b-2 border-blue-500 py-3 px-1 text-sm font-medium text-blue-600 transition duration-150" data-tab="dashboard" onclick="switchTab('dashboard')">ëŒ€ì‹œë³´ë“œ</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="rtu-manage" onclick="switchTab('rtu-manage')">RTU ë“±ë¡/ê´€ë¦¬</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="inspection-manage" onclick="switchTab('inspection-manage')">ì ê²€ ê¸°ë¡</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="repair-manage" onclick="switchTab('repair-manage')">ìˆ˜ë¦¬ ê¸°ë¡</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="report-page" onclick="switchTab('report-page')">ë³´ê³ ì„œ</button>
        </nav>
      </div>

      <div class="mt-6">
        <div id="dashboard" class="tab-page">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-blue-50 p-5 rounded-xl shadow-lg border border-blue-200">
              <p class="text-sm font-medium text-blue-600">ì´ ë“±ë¡ ì¥ë¹„ ìˆ˜</p>
              <p id="dashboard-total" class="text-3xl font-extrabold text-blue-900 mt-1">0</p>
            </div>
            <div class="bg-green-50 p-5 rounded-xl shadow-lg border border-green-200">
              <p class="text-sm font-medium text-green-600">ì‘ë™ì¤‘</p>
              <p id="dashboard-running" class="text-3xl font-extrabold text-green-900 mt-1">0</p>
            </div>
            <div class="bg-gray-50 p-5 rounded-xl shadow-lg border border-gray-200">
              <p class="text-sm font-medium text-gray-600">ì •ì§€ë¨</p>
              <p id="dashboard-stopped" class="text-3xl font-extrabold text-gray-900 mt-1">0</p>
            </div>
            <div class="bg-red-50 p-5 rounded-xl shadow-lg border border-red-200">
              <p class="text-sm font-medium text-red-600">ì ê²€ í•„ìš”</p>
              <p id="dashboard-needs-inspection" class="text-3xl font-extrabold text-red-900 mt-1">0</p>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border">
              <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">ìµœê·¼ ì²˜ë¦¬ í˜„í™©</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center text-gray-700">
                  <span class="font-medium">ì´ë²ˆ ë‹¬ ì ê²€ ê±´ìˆ˜</span>
                  <span id="dashboard-monthly-inspection" class="text-xl font-bold text-blue-600">0</span>
                </div>
                <div class="flex justify-between items-center text-gray-700">
                  <span class="font-medium">ë¯¸ì²˜ë¦¬ ìˆ˜ë¦¬ ìš”ì²­</span>
                  <span id="dashboard-pending-repair" class="text-xl font-bold text-red-600">0</span>
                </div>
              </div>
            </div>

            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border">
              <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">ê°œë³„ ì¥ë¹„ ìƒíƒœ (ìµœê·¼ ë“±ë¡/ìˆ˜ì •)</h3>
              <div id="dashboard-latest-list" class="space-y-3">
                <p class="text-gray-500">ë¡œë”© ì¤‘...</p>
              </div>
            </div>
          </div>

          <!-- ğŸ”„ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ë²„íŠ¼ -->
          <div class="mt-6 text-center">
            <button onclick="generateSampleData()" class="bg-indigo-600 text-white font-semibold px-6 py-2 rounded-full hover:bg-indigo-700 transition">
              ğŸ”„ í…ŒìŠ¤íŠ¸ìš© ê¸°ë³¸ ë°ì´í„° ìƒì„±
            </button>
            <p class="text-sm text-gray-500 mt-1">(Firebaseì— ìƒ˜í”Œ RTU / ì ê²€ / ìˆ˜ë¦¬ ë°ì´í„°ê°€ ìë™ ì¶”ê°€ë©ë‹ˆë‹¤)</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD6-IKznyhHIH6eGztJOioL0cDQ57MvNvs",
      authDomain: "rtu-system-han.firebaseapp.com",
      databaseURL: "https://rtu-system-han-default-rtdb.firebaseio.com",
      projectId: "rtu-system-han",
      storageBucket: "rtu-system-han.firebasestorage.app",
      messagingSenderId: "960060003353",
      appId: "1:960060003353:web:0185fc4a392235fab0c688",
      measurementId: "G-L58S7K0264"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let rtuList = [];
    let inspectionList = [];
    let repairList = [];

    function snapObjToArray(obj){ return obj ? Object.keys(obj).map(k=>({ ...obj[k], id:k })) : []; }

    onValue(ref(db,'rtuList'), snap=>{ rtuList = snapObjToArray(snap.val()); renderDashboard(); });
    onValue(ref(db,'inspectionList'), snap=>{ inspectionList = snapObjToArray(snap.val()); renderDashboard(); });
    onValue(ref(db,'repairList'), snap=>{ repairList = snapObjToArray(snap.val()); renderDashboard(); });

    async function saveRtuToDB(rtu){ if(!rtu.id) rtu.id='RTU-'+Date.now(); await set(ref(db,`rtuList/${rtu.id}`),rtu); }
    async function saveInspectionToDB(ins){ if(!ins.id) ins.id='INS-'+Date.now(); await set(ref(db,`inspectionList/${ins.id}`),ins); }
    async function saveRepairToDB(rep){ if(!rep.id) rep.id='REP-'+Date.now(); await set(ref(db,`repairList/${rep.id}`),rep); }

    window.generateSampleData = async function(){
      const sampleRtu=[
        {id:'RTU-001',name:'ì„œìš¸-01',region:'ì„œìš¸',status:'ì‘ë™ì¤‘',model:'GMX-1000',capacity:'10RT',date:new Date().toISOString()},
        {id:'RTU-002',name:'ë¶€ì‚°-02',region:'ë¶€ì‚°',status:'ì •ì§€ë¨',model:'GMX-800',capacity:'8RT',date:new Date().toISOString()},
        {id:'RTU-003',name:'ëŒ€ì „-03',region:'ëŒ€ì „',status:'ì ê²€í•„ìš”',model:'GMX-500',capacity:'5RT',date:new Date().toISOString()}
      ];
      const sampleInspection=[
        {id:'INS-001',rtuId:'RTU-001',inspectionDate:'2025-10-01',inspector:'ê¹€ì ê²€',result:'ì •ìƒ',notes:'íŒ¬ ì‘ë™ ì–‘í˜¸'},
        {id:'INS-002',rtuId:'RTU-002',inspectionDate:'2025-09-25',inspector:'ë°•ì—”ì§€ë‹ˆì–´',result:'ì£¼ì˜',notes:'í•„í„° ì˜¤ì—¼'},
        {id:'INS-003',rtuId:'RTU-003',inspectionDate:'2025-10-10',inspector:'ì´í…ŒìŠ¤íŠ¸',result:'ë¶ˆëŸ‰',notes:'ì»´í”„ë ˆì„œ ì´ìƒ'}
      ];
      const sampleRepair=[
        {id:'REP-001',rtuId:'RTU-003',repairDate:'2025-10-15',engineer:'ì¡°ìˆ˜ë¦¬',status:'ì§„í–‰ì¤‘',issue:'ì••ì¶•ê¸° êµì²´ ì˜ˆì •'},
        {id:'REP-002',rtuId:'RTU-002',repairDate:'2025-09-27',engineer:'ìµœìˆ˜ë¦¬',status:'ì™„ë£Œ',issue:'í•„í„° êµì²´ ì™„ë£Œ'},
        {id:'REP-003',rtuId:'RTU-001',repairDate:'2025-09-20',engineer:'ê¹€ì •ë¹„',status:'ì™„ë£Œ',issue:'ëƒ‰ë§¤ ë³´ì¶©'}
      ];
      for(const r of sampleRtu) await saveRtuToDB(r);
      for(const i of sampleInspection) await saveInspectionToDB(i);
      for(const rp of sampleRepair) await saveRepairToDB(rp);
      alert('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ Firebaseì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function renderDashboard(){
      document.getElementById('dashboard-total').textContent = rtuList.length;
      document.getElementById('dashboard-running').textContent = rtuList.filter(r=>r.status==='ì‘ë™ì¤‘').length;
      document.getElementById('dashboard-stopped').textContent = rtuList.filter(r=>r.status==='ì •ì§€ë¨').length;
      document.getElementById('dashboard-needs-inspection').textContent = rtuList.filter(r=>r.status==='ì ê²€í•„ìš”').length;
      document.getElementById('dashboard-monthly-inspection').textContent = inspectionList.length;
      document.getElementById('dashboard-pending-repair').textContent = repairList.filter(r=>r.status!=='ì™„ë£Œ').length;
      const latest=document.getElementById('dashboard-latest-list');
      if(!rtuList.length){ latest.innerHTML='<p class="text-gray-500">ë“±ë¡ëœ ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
      latest.innerHTML=rtuList.map(r=>`<div class='flex justify-between items-center border-b pb-2'><span>${r.name} (${r.region})</span><span class='text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full'>${r.status}</span></div>`).join('');
    }

    window.switchTab=function(tab){ document.querySelectorAll('.tab-page').forEach(e=>e.classList.add('hidden')); document.getElementById(tab).classList.remove('hidden'); document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('tab-active','border-blue-500','text-blue-600')); document.querySelector(`.tab-btn[data-tab="${tab}"]`).classList.add('tab-active','border-blue-500','text-blue-600'); };
  </script>
</body>
</html>
