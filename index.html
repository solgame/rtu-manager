<!DOCTYPE HTML>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RTU í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ (Firebase í´ë¼ìš°ë“œ ë™ê¸°í™”)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background:#f3f4f6; }
    /* .thumb í´ë˜ìŠ¤ê°€ ì´ë¯¸ì§€ë¿ë§Œ ì•„ë‹ˆë¼ í”Œë ˆì´ìŠ¤í™€ë”ì—ë„ ì ìš©ë˜ë„ë¡ ìœ ì§€í•©ë‹ˆë‹¤. */
    .thumb { width:96px; height:72px; object-fit:cover; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.08); } 
    .thumb-detail { width: 150px; height: 100px; object-fit: cover; border-radius: 6px; cursor: pointer; transition: transform 0.15s; }
    .thumb-detail:hover { transform: scale(1.03); }
    .hidden-file { position:absolute; left:-9999px; }
    .modal-bg { background: rgba(17,24,39,0.6); }
    .tab-active { border-color: #3b82f6 !important; color: #3b82f6; font-weight: 600; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(59, 130, 246, 0.3); border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .pagination-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* ========== ë³´ê³ ì„œ ì¸ì‡„ë¥¼ ìœ„í•œ CSS ì¶”ê°€ (print-onlyëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ) ========== */
    .print-only { display: none; } /* ê¸°ì¡´ ì½”ë“œì—ì„œ ë‚¨ì•„ìˆëŠ” print-onlyëŠ” display:none; ìƒíƒœ ìœ ì§€ */
    @media print {
      /* ì•±ì˜ ê¸°ë³¸ ë°°ê²½ê³¼ í…Œë‘ë¦¬ë¥¼ ìˆ¨ê²¨ ì¸ì‡„ ì˜ì—­ì„ ê¹”ë”í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. */
      .print-container, #main-app-container { /* ì¸ì‡„ ë¬¸ì œ í•´ê²°: ë©”ì¸ ì»¨í…Œì´ë„ˆ ê°•ì œ í‘œì‹œ */
        padding: 0 !important;
        margin: 0 !important;
        box-shadow: none !important;
        background: white !important;
      }
      /* ì¸ì‡„ ì‹œ ìˆ¨ê²¨ì•¼ í•  ìš”ì†Œ (ë²„íŠ¼, ë©”ë‰´ ë“±) */
      .print-hidden, .tab-page:not(#report-page), .tab-btn, .border-b, .mb-4, .pb-4 {
        display: none !important;
      }
      /* ì¸ì‡„ ì‹œ ìƒì„¸ ë³´ê³ ì„œ ë‚´ìš©ë§Œ í‘œì‹œë¥¼ ìœ„í•´ report-pageì™€ detail-viewë¥¼ ê°•ì œ í‘œì‹œ */
      #report-page, #report-detail-view { /* ì¸ì‡„ ë¬¸ì œ í•´ê²°: ë³´ê³ ì„œ ê´€ë ¨ ìš”ì†Œ ê°•ì œ í‘œì‹œ ë° ì •ë¦¬ */
        display: block !important;
        padding: 0 !important;
        margin: 0 !important;
        box-shadow: none !important;
        border: none !important;
        margin-top: 0 !important;
      }
      table {
          width: 100%;
          border-collapse: collapse;
      }
      th, td {
          border: 1px solid #ccc;
          padding: 8px;
      }
      /* ìƒíƒœ íƒœê·¸ì˜ ë°°ê²½ìƒ‰ì€ ì¸ì‡„ ì‹œ ì œê±° */
      .bg-green-100, .bg-yellow-100, .bg-red-100, .bg-slate-200, .bg-indigo-100, .bg-pink-100, .bg-teal-100 {
          background-color: transparent !important;
          color: black !important;
          border: 1px solid #ccc !important; /* ì¸ì‡„ ì‹œ ì˜ ë³´ì´ë„ë¡ í…Œë‘ë¦¬ ì¶”ê°€ */
      }
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-6xl mx-auto p-4 sm:p-8 print-container">
    <div class="bg-white rounded-2xl shadow-xl p-6" id="main-app-container">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b pb-4 mb-4 print-hidden">
        <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37.526.34 1.144.354 1.63.153z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          RTU í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ
        </h1>
        <div class="flex items-center space-x-3 mt-4 sm:mt-0">
          <label for="csv-upload" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-full hover:bg-blue-700 transition duration-150 text-sm cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1 transform rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            ë°ì´í„° CSV ì—…ë¡œë“œ
          </label>
          <input type="file" id="csv-upload" accept=".csv" multiple class="hidden-file">
          <button id="download-data-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-full hover:bg-gray-300 transition duration-150 text-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            ë°ì´í„° CSV ë‹¤ìš´ë¡œë“œ
          </button>
        </div>
      </div>

      <div class="border-b border-gray-200 print-hidden">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
          <button class="tab-btn tab-active border-b-2 border-blue-500 py-3 px-1 text-sm font-medium text-blue-600 transition duration-150" data-tab="dashboard">ëŒ€ì‹œë³´ë“œ</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="rtu-manage">RTU ë“±ë¡/ê´€ë¦¬</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="inspection-manage">ì ê²€ ê¸°ë¡</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="repair-manage">ìˆ˜ë¦¬ ê¸°ë¡</button>
          <button class="tab-btn border-b-2 border-transparent py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition duration-150" data-tab="report-page">ë³´ê³ ì„œ</button>
        </nav>
      </div>

      <div class="mt-6">
        <div id="dashboard" class="tab-page">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-blue-50 p-5 rounded-xl shadow-lg border border-blue-200">
              <p class="text-sm font-medium text-blue-600">ì´ ë“±ë¡ ì¥ë¹„ ìˆ˜</p>
              <p id="dashboard-total" class="text-3xl font-extrabold text-blue-900 mt-1">0</p>
            </div>
            <div class="bg-green-50 p-5 rounded-xl shadow-lg border border-green-200">
              <p class="text-sm font-medium text-green-600">ì‘ë™ì¤‘</p>
              <p id="dashboard-running" class="text-3xl font-extrabold text-green-900 mt-1">0</p>
            </div>
            <div class="bg-gray-50 p-5 rounded-xl shadow-lg border border-gray-200">
              <p class="text-sm font-medium text-gray-600">ì •ì§€ë¨</p>
              <p id="dashboard-stopped" class="text-3xl font-extrabold text-gray-900 mt-1">0</p>
            </div>
            <div class="bg-red-50 p-5 rounded-xl shadow-lg border border-red-200">
              <p class="text-sm font-medium text-red-600">ì ê²€ í•„ìš”</p>
              <p id="dashboard-needs-inspection" class="text-3xl font-extrabold text-red-900 mt-1">0</p>
            </div>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border">
              <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">ìµœê·¼ ì²˜ë¦¬ í˜„í™©</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center text-gray-700">
                  <span class="font-medium">ì´ë²ˆ ë‹¬ ì ê²€ ê±´ìˆ˜</span>
                  <span id="dashboard-monthly-inspection" class="text-xl font-bold text-blue-600">0</span>
                </div>
                <div class="flex justify-between items-center text-gray-700">
                  <span class="font-medium">ë¯¸ì²˜ë¦¬ ìˆ˜ë¦¬ ìš”ì²­</span>
                  <span id="dashboard-pending-repair" class="text-xl font-bold text-red-600">0</span>
                </div>
              </div>
            </div>
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border">
              <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">ê°œë³„ ì¥ë¹„ ìƒíƒœ (ìµœê·¼ ë“±ë¡/ìˆ˜ì •)</h3>
              <div id="dashboard-latest-list" class="space-y-3">
                <p class="text-gray-500">ë¡œë”© ì¤‘...</p>
              </div>
            </div>
          </div>
        </div>

        <div id="rtu-manage" class="tab-page hidden">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border h-fit">
              <div class="flex justify-center mb-4 border-b pb-4">
                <button id="mode-new-btn" class="px-4 py-2 text-sm font-semibold rounded-l-lg bg-blue-600 text-white transition duration-150">ì‹ ê·œ ë“±ë¡</button>
                <button id="mode-modify-btn" class="px-4 py-2 text-sm font-semibold rounded-r-lg bg-gray-200 text-gray-700 transition duration-150">ì •ë³´ ìˆ˜ì •</button>
              </div>
              <h2 id="rtu-form-title" class="text-xl font-bold text-gray-800 mb-4">RTU ì¥ë¹„ ì‹ ê·œ ë“±ë¡</h2>
              <form id="rtu-form" class="space-y-4">
                <input type="hidden" id="rtu-id-for-modification" name="rtuIdForModification" value="">
                <div id="rtu-id-container">
                  <div>
                    <label for="rtu-name" class="block text-sm font-medium text-gray-700">RTU ë“±ë¡ë²ˆí˜¸/ID *</label>
                    <input type="text" id="rtu-name" name="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <select id="rtu-modify-select" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500 hidden">
                      <option value="">-- ìˆ˜ì •í•  RTUë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label for="rtu-region" class="block text-sm font-medium text-gray-700">ì„¤ì¹˜ ì¥ì†Œ/ì§€ì—­ *</label>
                  <input type="text" id="rtu-region" name="region" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div>
                  <label for="rtu-model" class="block text-sm font-medium text-gray-700">ëª¨ë¸ëª…</label>
                  <input type="text" id="rtu-model" name="model" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div>
                  <label for="rtu-capacity" class="block text-sm font-medium text-gray-700">ìš©ëŸ‰ (ëƒ‰ë™í†¤/kW)</label>
                  <input type="text" id="rtu-capacity" name="capacity" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div>
                  <label for="rtu-unit-type" class="block text-sm font-medium text-gray-700">ìœ ë‹› ì¢…ë¥˜</label>
                  <select id="rtu-unit-type" name="unitType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <option value="íŒ¨í‚¤ì§€">íŒ¨í‚¤ì§€</option>
                    <option value="ì¹ ëŸ¬">ì¹ ëŸ¬</option>
                    <option value="ëƒ‰ê°íƒ‘">ëƒ‰ê°íƒ‘</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                  </select>
                </div>
                <div>
                  <label for="rtu-refrigerant" class="block text-sm font-medium text-gray-700">ëƒ‰ë§¤ ì¢…ë¥˜</label>
                  <input type="text" id="rtu-refrigerant" name="refrigerant" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500" value="R-410A">
                </div>
                <div>
                  <label for="rtu-electric-phase" class="block text-sm font-medium text-gray-700">ì „ê¸° ì¢…ë¥˜</label>
                  <select id="rtu-electric-phase" name="electricPhase" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <option value="ë‹¨ìƒ">ë‹¨ìƒ (Single Phase)</option>
                    <option value="ì‚¼ìƒ">ì‚¼ìƒ (Three Phase)</option>
                  </select>
                </div>
                <div>
                  <label for="rtu-date" class="block text-sm font-medium text-gray-700">ì„¤ì¹˜(ë“±ë¡) ë‚ ì§œ</label>
                  <input type="date" id="rtu-date" name="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div>
                  <label for="rtu-status" class="block text-sm font-medium text-gray-700">í˜„ì¬ ìƒíƒœ *</label>
                  <select id="rtu-status" name="status" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <option value="ì‘ë™ì¤‘">ì‘ë™ì¤‘</option>
                    <option value="ì •ì§€ë¨">ì •ì§€ë¨</option>
                    <option value="ì ê²€í•„ìš”">ì ê²€í•„ìš”</option>
                  </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label for="rtu-pressure-high" class="block text-sm font-medium text-gray-700">ê³ ì•• ìƒí•œ ì„¤ì • (PSI)</label>
                    <input type="number" id="rtu-pressure-high" name="pressureHighLimit" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                  </div>
                  <div>
                    <label for="rtu-pressure-low" class="block text-sm font-medium text-gray-700">ì €ì•• í•˜í•œ ì„¤ì • (PSI)</label>
                    <input type="number" id="rtu-pressure-low" name="pressureLowLimit" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                  </div>
                </div>
                <div>
                  <label for="rtu-notes" class="block text-sm font-medium text-gray-700">íŠ¹ì´ì‚¬í•­ ë° ë©”ëª¨</label>
                  <textarea id="rtu-notes" name="notes" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500"></textarea>
                </div>
                <div class="space-y-3">
                  <label class="block text-sm font-medium text-gray-700">ì¥ë¹„ ì‚¬ì§„ (ìµœëŒ€ 3ì¥)</label>
                  <div class="flex space-x-2">
                    <input type="file" id="rtu-image1" name="image1" accept="image/*" class="hidden-file">
                    <label for="rtu-image1" class="cursor-pointer bg-blue-500 text-white text-sm font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-150">ì‚¬ì§„ 1 ì—…ë¡œë“œ</label>
                  </div>
                  <div class="flex space-x-2">
                    <input type="file" id="rtu-image2" name="image2" accept="image/*" class="hidden-file">
                    <label for="rtu-image2" class="cursor-pointer bg-blue-500 text-white text-sm font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-150">ì‚¬ì§„ 2 ì—…ë¡œë“œ</label>
                  </div>
                  <div class="flex space-x-2">
                    <input type="file" id="rtu-image3" name="image3" accept="image/*" class="hidden-file">
                    <label for="rtu-image3" class="cursor-pointer bg-blue-500 text-white text-sm font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-150">ì‚¬ì§„ 3 ì—…ë¡œë“œ</label>
                  </div>
                </div>
                <div id="image-preview-container" class="mt-4 hidden space-y-4 p-4 border rounded-lg bg-gray-50">
                  <h4 class="text-sm font-medium text-gray-700">ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</h4>
                  <div class="flex flex-wrap gap-4">
                    <img id="image-preview-1" src="" alt="Image 1 Preview" class="thumb" style="display:none;">
                    <img id="image-preview-2" src="" alt="Image 2 Preview" class="thumb" style="display:none;">
                    <img id="image-preview-3" src="" alt="Image 3 Preview" class="thumb" style="display:none;">
                  </div>
                </div>
                <button id="rtu-submit-btn" type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition duration-150 mt-6">RTU ì •ë³´ ì €ì¥</button>
              </form>
            </div>
            <div class="lg:col-span-2">
              <h2 class="text-2xl font-bold text-gray-800 mb-4">RTU ë“±ë¡ ëª©ë¡ (<span id="rtu-count">0</span>ê±´)</h2>
              <div id="rtu-list" class="space-y-4">
                <p class="text-gray-500 italic">ë“±ë¡ëœ RTU ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
              <div id="rtu-pagination" class="flex justify-center mt-4"></div>
            </div>
          </div>
        </div>

        <div id="inspection-manage" class="tab-page hidden">
          <div class="grid grid-cols-1 lg:col-span-3 gap-6">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border h-fit">
              <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ì ê²€ ê¸°ë¡ ë“±ë¡</h2>
              <form id="inspection-form" class="space-y-4">
                <div>
                  <label for="inspection-rtu-id" class="block text-sm font-medium text-gray-700">ëŒ€ìƒ RTU *</label>
                  <select id="inspection-rtu-id" name="rtuId" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <option value="">-- RTUë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                  </select>
                </div>
                <div>
                  <label for="inspection-date" class="block text-sm font-medium text-gray-700">ì ê²€ ë‚ ì§œ *</label>
                  <input type="date" id="inspection-date" name="inspectionDate" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div>
                  <label for="inspection-inspector" class="block text-sm font-medium text-gray-700">ì ê²€ì ì´ë¦„ *</label>
                  <input type="text" id="inspection-inspector" name="inspector" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div class="border p-4 rounded-lg bg-indigo-50 space-y-3">
                  <h3 class="text-lg font-semibold text-indigo-800">ë¶€í’ˆ ì ê²€ ìƒíƒœ</h3>
                  <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                    <div>
                      <label for="check1" class="block font-medium text-gray-700">1. í•„í„°</label>
                      <select id="check1" name="check1" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì •ìƒ">ì •ìƒ</option>
                        <option value="êµì²´í•„ìš”">êµì²´í•„ìš”</option>
                      </select>
                    </div>
                    <div>
                      <label for="check2" class="block font-medium text-gray-700">2. ì½˜í…í„°</label>
                      <select id="check2" name="check2" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì •ìƒ">ì •ìƒ</option>
                        <option value="ì†Œì†/êµì²´í•„ìš”">ì†Œì†/êµì²´í•„ìš”</option>
                      </select>
                    </div>
                    <div>
                      <label for="check3" class="block font-medium text-gray-700">3. ì½˜ë´ì‹± ì½”ì¼</label>
                      <select id="check3" name="check3" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì–‘í˜¸">ì–‘í˜¸</option>
                        <option value="ì˜¤ì—¼/ì²­ì†Œí•„ìš”">ì˜¤ì—¼/ì²­ì†Œí•„ayo</option>
                      </select>
                    </div>
                    <div>
                      <label for="check4" class="block font-medium text-gray-700">4. ì†¡í’ ëª¨í„°</label>
                      <select id="check4" name="check4" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì •ìƒ">ì •ìƒ</option>
                        <option value="ì†ŒìŒ/ìˆ˜ë¦¬í•„ìš”">ì†ŒìŒ/ìˆ˜ë¦¬í•„ìš”</option>
                      </select>
                    </div>
                    <div>
                      <label for="check5" class="block font-medium text-gray-700">5. ì¦ë°œê¸° ì½”ì¼</label>
                      <select id="check5" name="check5" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì–‘í˜¸">ì–‘í˜¸</option>
                        <option value="ì˜¤ì—¼/ì²­ì†Œí•„ìš”">ì˜¤ì—¼/ì²­ì†Œí•„ìš”</option>
                      </select>
                    </div>
                    <div>
                      <label for="check6" class="block font-medium text-gray-700">6. ê³ ì•• ì„¼ì„œ</label>
                      <select id="check6" name="check6" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì •ìƒ">ì •ìƒ</option>
                        <option value="ì˜¤ë¥˜">ì˜¤ë¥˜</option>
                      </select>
                    </div>
                    <div>
                      <label for="check7" class="block font-medium text-gray-700">7. ì €ì•• ì„¼ì„œ</label>
                      <select id="check7" name="check7" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì •ìƒ">ì •ìƒ</option>
                        <option value="ì˜¤ë¥˜">ì˜¤ë¥˜</option>
                      </select>
                    </div>
                    <div>
                      <label for="check8" class="block font-medium text-gray-700">8. ìºíŒ¨ì‹œí„°</label>
                      <select id="check8" name="check8" class="mt-1 w-full border-gray-300 rounded-md p-1 border">
                        <option value="ì •ìƒ">ì •ìƒ</option>
                        <option value="ë¶ˆëŸ‰">ë¶ˆëŸ‰</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="border p-4 rounded-lg bg-red-50 space-y-3">
                  
<div class="border p-4 rounded-lg bg-yellow-50 space-y-3">
  <h3 class="text-lg font-semibold text-yellow-800">ìš´ì „ ìƒíƒœ ì¸¡ì • (Comp 1)</h3>
  <div class="grid grid-cols-3 gap-3">
    <div>
      <label for="comp1Hp" class="block text-sm font-medium text-gray-700">ê³ ì•• (PSI)</label>
      <input type="number" id="comp1Hp" name="comp1Hp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
    </div>
    <div>
      <label for="comp1Lp" class="block text-sm font-medium text-gray-700">ì €ì•• (PSI)</label>
      <input type="number" id="comp1Lp" name="comp1Lp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
    </div>
    <div>
      <label for="comp1Amp" class="block text-sm font-medium text-gray-700">ì „ë¥˜ (A)</label>
      <input type="number" id="comp1Amp" name="comp1Amp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
    </div>
  </div>
</div>

<div class="border p-4 rounded-lg bg-yellow-50 space-y-3">
  <h3 class="text-lg font-semibold text-yellow-800">ìš´ì „ ìƒíƒœ ì¸¡ì • (Comp 2)</h3>
  <div class="grid grid-cols-3 gap-3">
    <div>
      <label for="comp2Hp" class="block text-sm font-medium text-gray-700">ê³ ì•• (PSI)</label>
      <input type="number" id="comp2Hp" name="comp2Hp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
    </div>
    <div>
      <label for="comp2Lp" class="block text-sm font-medium text-gray-700">ì €ì•• (PSI)</label>
      <input type="number" id="comp2Lp" name="comp2Lp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
    </div>
    <div>
      <label for="comp2Amp" class="block text-sm font-medium text-gray-700">ì „ë¥˜ (A)</label>
      <input type="number" id="comp2Amp" name="comp2Amp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
    </div>
  </div>
</div>
<h3 class="text-lg font-semibold text-red-800">ì˜¨ë„ ì¸¡ì •</h3>
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label for="superheat" class="block text-sm font-medium text-gray-700">ê³¼ì—´ë„ (â„‰)</label>
                      <input type="number" step="0.1" id="superheat" name="superheat" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                    <div>
                      <label for="subcool" class="block text-sm font-medium text-gray-700">ê³¼ëƒ‰ë„ (â„‰)</label>
                      <input type="number" step="0.1" id="subcool" name="subcool" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                  </div>
                </div>
                <div>
                  <label for="inspection-result" class="block text-sm font-medium text-gray-700">ìµœì¢… ì ê²€ ê²°ê³¼ *</label>
                  <select id="inspection-result" name="result" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <option value="ì •ìƒ">ì •ìƒ</option>
                    <option value="ì£¼ì˜">ì£¼ì˜</option>
                    <option value="ì ê²€í•„ìš”">ì ê²€í•„ìš”</option>
                  </select>
                </div>
                <div>
                  <label for="inspection-notes" class="block text-sm font-medium text-gray-700">íŠ¹ì´ì‚¬í•­ ë° ì¡°ì¹˜ ë‚´ìš©</label>
                  <textarea id="inspection-notes" name="notes" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500"></textarea>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition duration-150 mt-6">ì ê²€ ê¸°ë¡ ì €ì¥</button>
              </form>
            </div>
            <div class="lg:col-span-2">
              <h2 class="text-2xl font-bold text-gray-800 mb-4">ì ê²€ ê¸°ë¡ ëª©ë¡ (<span id="inspection-count">0</span>ê±´)</h2>
              <div id="inspection-list" class="space-y-4">
                <p class="text-gray-500 italic">ë“±ë¡ëœ ì ê²€ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
              <div id="inspection-pagination" class="flex justify-center mt-4"></div>
            </div>
          </div>
        </div>

        <div id="repair-manage" class="tab-page hidden">
          <div class="grid grid-cols-1 lg:col-cols-3 gap-6">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border h-fit">
              <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ìˆ˜ë¦¬ ê¸°ë¡ ë“±ë¡</h2>
              <form id="repair-form" class="space-y-4">
                <div>
                  <label for="repair-rtu-id" class="block text-sm font-medium text-gray-700">ëŒ€ìƒ RTU *</label>
                  <select id="repair-rtu-id" name="rtuId" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <option value="">-- RTUë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                  </select>
                </div>
                <div>
                  <label for="repair-date" class="block text-sm font-medium text-gray-700">ìˆ˜ë¦¬ ìš”ì²­/ì™„ë£Œ ë‚ ì§œ *</label>
                  <input type="date" id="repair-date" name="repairDate" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div>
                  <label for="repair-engineer" class="block text-sm font-medium text-gray-700">ìˆ˜ë¦¬ ë‹´ë‹¹ì *</label>
                  <input type="text" id="repair-engineer" name="engineer" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
                <div>
                  <label for="repair-status" class="block text-sm font-medium text-gray-700">ì²˜ë¦¬ ìƒíƒœ *</label>
                  <select id="repair-status" name="status" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    <option value="ìš”ì²­">ìš”ì²­ (ë¯¸ì²˜ë¦¬)</option>
                    <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                    <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                  </select>
                </div>
                <div>
                  <label for="repair-issue" class="block text-sm font-medium text-gray-700">ë¬¸ì œ ë° ì¡°ì¹˜ ë‚´ìš© *</label>
                  <textarea id="repair-issue" name="issue" rows="5" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500"></textarea>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition duration-150 mt-6">ìˆ˜ë¦¬ ê¸°ë¡ ì €ì¥</button>
              </form>
            </div>
            <div class="lg:col-span-2">
              <h2 class="text-2xl font-bold text-gray-800 mb-4">ìˆ˜ë¦¬ ê¸°ë¡ ëª©ë¡ (<span id="repair-count">0</span>ê±´)</h2>
              <div id="repair-list" class="space-y-4">
                <p class="text-gray-500 italic">ë“±ë¡ëœ ìˆ˜ë¦¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
              <div id="repair-pagination" class="flex justify-center mt-4"></div>
            </div>
          </div>
        </div>

        <div id="report-page" class="tab-page hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-4 print-hidden">ì‹œìŠ¤í…œ ìš´ì˜ ë³´ê³ ì„œ</h2>
          <p class="text-gray-600 mb-6 print-hidden">ì•„ë˜ ìš”ì•½ í•­ëª©ì„ í´ë¦­í•˜ì‹œë©´ ìƒì„¸ ëª©ë¡ì„ í™•ì¸í•˜ê³  ì¸ì‡„í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ–¨ï¸</p>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 print-hidden">
            <div id="report-rtu-summary" class="bg-indigo-50 p-6 rounded-xl shadow-lg border border-indigo-200 cursor-pointer hover:bg-indigo-100 transition duration-150">
              <p class="text-sm font-medium text-indigo-600">ì´ ë“±ë¡ RTU</p>
              <p id="report-total-rtu" class="text-3xl font-extrabold text-indigo-900 mt-1">0</p>
            </div>
            <div id="report-inspection-summary" class="bg-pink-50 p-6 rounded-xl shadow-lg border border-pink-200 cursor-pointer hover:bg-pink-100 transition duration-150">
              <p class="text-sm font-medium text-pink-600">ì´ ì ê²€ ê¸°ë¡ ê±´ìˆ˜</p>
              <p id="report-total-inspection" class="text-3xl font-extrabold text-pink-900 mt-1">0</p>
            </div>
            <div id="report-repair-summary" class="bg-teal-50 p-6 rounded-xl shadow-lg border border-teal-200 cursor-pointer hover:bg-teal-100 transition duration-150">
              <p class="text-sm font-medium text-teal-600">ì´ ìˆ˜ë¦¬ ê¸°ë¡ ê±´ìˆ˜</p>
              <p id="report-total-repair" class="text-3xl font-extrabold text-teal-900 mt-1">0</p>
            </div>
          </div>
          
          <div id="report-detail-view" class="mt-8 bg-white p-6 rounded-xl shadow-lg border hidden">
            <p class="text-gray-500">ë³´ê³ ì„œë¥¼ ë³´ë ¤ë©´ ìœ„ì˜ ìš”ì•½ í•­ëª©ì„ í´ë¦­í•˜ì„¸ìš”.</p>
          </div>
          
          <p class="text-gray-600 border-t pt-4 mt-8 print-hidden">ë³´ë‹¤ ìƒì„¸í•œ ë°ì´í„° ë¶„ì„ ë° ë³´ê³ ëŠ” ìƒë‹¨ì˜ **ë°ì´í„° CSV ë‹¤ìš´ë¡œë“œ/ì—…ë¡œë“œ** ë²„íŠ¼ì„ í†µí•´ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ ì§„í–‰í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </div>

  <div id="detail-modal" class="modal-bg hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 relative">
      <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ìƒì„¸ ì •ë³´</h3>
      <div id="modal-content" class="text-gray-700 space-y-2 text-sm">
        <p>ë¡œë”© ì¤‘...</p>
      </div>
      <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>
  
  <div id="image-zoom-modal" class="modal-bg hidden fixed inset-0 z-[60] flex items-center justify-center p-4" onclick="document.getElementById('image-zoom-modal').classList.add('hidden')">
    <div class="max-w-4xl max-h-[90vh] w-full p-4">
      <img id="zoomed-image" src="" alt="í™•ëŒ€ ì´ë¯¸ì§€" class="max-w-full max-h-[80vh] w-auto h-auto mx-auto shadow-2xl rounded-lg">
      <button class="absolute top-4 right-4 text-white hover:text-gray-200 transition" onclick="document.getElementById('image-zoom-modal').classList.add('hidden'); event.stopPropagation();">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, get, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyD6-IKznyhHIH6eGztJOioL0cDQ57MvNvs",
      authDomain: "rtu-system-han.firebaseapp.com",
      databaseURL: "https://rtu-system-han-default-rtdb.firebaseio.com",
      projectId: "rtu-system-han",
      storageBucket: "rtu-system-han.firebasestorage.app",
      messagingSenderId: "960060003353",
      appId: "1:960060003353:web:0185fc4a392235fab0c688",
      measurementId: "G-L58S7K0264"
    };
    
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    window.firebaseDB = database;
    window.firebaseRef = ref;
    window.firebaseSet = set;
    window.firebaseOnValue = onValue;
    window.firebaseGet = get;
    window.firebaseRemove = remove;
    window.firebaseInitialized = true;
  </script>

  <script>
    /* ==================== ì „ì—­ ë³€ìˆ˜ ë° ì„¤ì • ==================== */
    const STORAGE_KEYS = {
      RTU: 'rtuList',
      INSPECTION: 'inspectionList',
      REPAIR: 'repairList'
    };
    
    let imageBase64Data = { imageUrl1: '', imageUrl2: '', imageUrl3: '' };
    let rtuList = [];
    let inspectionList = [];
    let repairList = [];
    let isFirebaseReady = false;
    let currentRtuMode = 'new';
    let currentModalData = { id: null, type: null };

    // Pagination Settings
    const PAGE_SIZE = 10;
    let rtuCurrentPage = 1;
    let inspectionCurrentPage = 1;
    let repairCurrentPage = 1;

    const elements = {
      rtuForm: document.getElementById('rtu-form'),
      rtuCount: document.getElementById('rtu-count'),
      rtuListContainer: document.getElementById('rtu-list'),
      rtuPaginationContainer: document.getElementById('rtu-pagination'),
      inspectionForm: document.getElementById('inspection-form'),
      inspectionCount: document.getElementById('inspection-count'),
      inspectionListContainer: document.getElementById('inspection-list'),
      inspectionPaginationContainer: document.getElementById('inspection-pagination'),
      inspectionRtuIdSelect: document.getElementById('inspection-rtu-id'),
      repairForm: document.getElementById('repair-form'),
      repairCount: document.getElementById('repair-count'),
      repairListContainer: document.getElementById('repair-list'),
      repairPaginationContainer: document.getElementById('repair-pagination'),
      repairRtuIdSelect: document.getElementById('repair-rtu-id'),
      detailModal: document.getElementById('detail-modal'),
      closeModalBtn: document.getElementById('close-modal-btn'),
      modalTitle: document.getElementById('modal-title'),
      modalContent: document.getElementById('modal-content'),
      imageZoomModal: document.getElementById('image-zoom-modal'),
      zoomedImage: document.getElementById('zoomed-image'),
      tabBtns: document.querySelectorAll('.tab-btn'),
      tabPages: document.querySelectorAll('.tab-page'),
      modeNewBtn: document.getElementById('mode-new-btn'),
      modeModifyBtn: document.getElementById('mode-modify-btn'),
      rtuFormTitle: document.getElementById('rtu-form-title'),
      rtuIdForModification: document.getElementById('rtu-id-for-modification'),
      rtuSubmitBtn: document.getElementById('rtu-submit-btn'),
      rtuModifySelect: document.getElementById('rtu-modify-select'),
      imagePreviewContainer: document.getElementById('image-preview-container'),
      imagePreview1: document.getElementById('image-preview-1'),
      imagePreview2: document.getElementById('image-preview-2'),
      imagePreview3: document.getElementById('image-preview-3'),
      dashboardTotal: document.getElementById('dashboard-total'),
      dashboardRunning: document.getElementById('dashboard-running'),
      dashboardStopped: document.getElementById('dashboard-stopped'),
      dashboardNeedsInspection: document.getElementById('dashboard-needs-inspection'),
      dashboardMonthlyInspection: document.getElementById('dashboard-monthly-inspection'),
      dashboardPendingRepair: document.getElementById('dashboard-pending-repair'),
      dashboardLatestList: document.getElementById('dashboard-latest-list'),
      reportTotalRtu: document.getElementById('report-total-rtu'),
      reportTotalInspection: document.getElementById('report-total-inspection'),
      reportTotalRepair: document.getElementById('report-total-repair'),
      // [ì‹ ê·œ] ë³´ê³ ì„œ ìƒì„¸ ê¸°ëŠ¥ ê´€ë ¨ ìš”ì†Œ
      reportRtuSummary: document.getElementById('report-rtu-summary'),
      reportInspectionSummary: document.getElementById('report-inspection-summary'),
      reportRepairSummary: document.getElementById('report-repair-summary'),
      reportDetailView: document.getElementById('report-detail-view') 
    };

    /* ==================== Firebase í•¨ìˆ˜ ==================== */

    function waitForFirebase() {
      return new Promise((resolve) => {
        const checkInterval = setInterval(() => {
          if (window.firebaseInitialized) {
            clearInterval(checkInterval);
            resolve();
          }
        }, 100);
      });
    }

    async function loadFromFirebase() {
      await waitForFirebase();

      const rtuRef = window.firebaseRef(window.firebaseDB, 'rtuList');
      window.firebaseOnValue(rtuRef, (snapshot) => {
        const data = snapshot.val();
        rtuList = data ? Object.values(data) : [];
        if (isFirebaseReady) {
          renderRtuList(rtuCurrentPage);
          populateRtuSelects();
          updateDashboard();
        }
      });

      const inspectionRef = window.firebaseRef(window.firebaseDB, 'inspectionList');
      window.firebaseOnValue(inspectionRef, (snapshot) => {
        const data = snapshot.val();
        inspectionList = data ? Object.values(data) : [];
        if (isFirebaseReady) {
          renderInspectionList(inspectionCurrentPage);
          updateDashboard();
        }
      });

      const repairRef = window.firebaseRef(window.firebaseDB, 'repairList');
      window.firebaseOnValue(repairRef, (snapshot) => {
        const data = snapshot.val();
        repairList = data ? Object.values(data) : [];
        if (isFirebaseReady) {
          // ìˆ˜ë¦¬ ê¸°ë¡ ë¯¸í‘œì‹œ ì˜¤ë¥˜ ìˆ˜ì •: onValue ì½œë°±ì´ ì •ìƒì ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ë Œë”ë§í•˜ë„ë¡ ë³´ì¥
          renderRepairList(repairCurrentPage);
          updateDashboard();
        }
      });

      isFirebaseReady = true;
    }

    async function saveToFirebase(key, list) {
      await waitForFirebase();
      const dbRef = window.firebaseRef(window.firebaseDB, key);
      const dataObject = list.reduce((acc, item) => {
        acc[item.id] = item;
        return acc;
      }, {});
      await window.firebaseSet(dbRef, dataObject);
    }

    async function deleteRtu(rtuId) {
      await waitForFirebase();
      const rtuRef = window.firebaseRef(window.firebaseDB, `rtuList/${rtuId}`);
      await window.firebaseRemove(rtuRef);

      // ê´€ë ¨ ì ê²€ ë° ìˆ˜ë¦¬ ê¸°ë¡ì€ ì¥ë¹„ IDë¥¼ ì‚¬ìš©í•˜ì—¬ í•„í„°ë§ë˜ì–´ í™”ë©´ì— í‘œì‹œë˜ì§€ë§Œ, 
      // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ì‚­ì œí•˜ì§€ ì•Šì•„ (ê¸°ë¡ ë³´ì¡´) ì¥ë¹„ëª…ì´ [êµ¬-ì¥ë¹„ë²ˆí˜¸]ë¡œ í‘œì‹œë©ë‹ˆë‹¤. 
      // ì´ëŠ” í˜„ì¬ `getRtuInfo` ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
    }

    /* ==================== í—¬í¼ í•¨ìˆ˜ ==================== */

    // RTU ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ë¦„ê³¼ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” í—¬í¼ í•¨ìˆ˜
    function getRtuInfo(rtuId) {
      const rtu = rtuList.find(r => r.name === rtuId);
      if (rtu) {
        return { name: rtu.name, status: rtu.status };
      }
      // ìš”ì²­í•˜ì‹  ëŒ€ë¡œ ì¥ë¹„ ì‚­ì œ ì‹œ "[êµ¬-"ì§€ì›Œì§„ ì¥ë¹„ë²ˆí˜¸"]" í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
      return { 
        name: `[êµ¬-"${rtuId}"]`, 
        status: 'ì‚­ì œë¨' 
      };
    }

    // ìƒíƒœì— ë”°ë¥¸ Tailwind CSS ìƒ‰ìƒ í´ë˜ìŠ¤ ë°˜í™˜
    function getStatusColor(status) {
      switch (status) {
        case 'ì‘ë™ì¤‘':
          return 'bg-green-100 text-green-800';
        case 'ì •ì§€ë¨':
          return 'bg-gray-100 text-gray-800';
        case 'ì ê²€í•„ìš”':
          return 'bg-red-100 text-red-800';
        case 'ì£¼ì˜':
          return 'bg-yellow-100 text-yellow-800';
        case 'ì‚­ì œë¨': // <-- ì‚­ì œëœ ì¥ë¹„ì— ëŒ€í•œ ìƒíƒœ ì¶”ê°€
          return 'bg-slate-200 text-slate-700';
        default:
          return 'bg-gray-100 text-gray-800';
      }
    }

    // íŒŒì¼ ë¡œë” í—¬í¼
    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        if (!file) return resolve('');
        const reader = new FileReader();
        reader.onload = (event) => resolve(event.target.result);
        reader.onerror = (error) => reject(error);
        reader.readAsDataURL(file);
      });
    }

    // ë‚ ì§œ í¬ë§· í—¬í¼
    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      // ë‚ ì§œ ê°ì²´ ìƒì„± ì‹œ í‘œì¤€ í¬ë§·ì´ ì•„ë‹ ê²½ìš° ì˜¤ë¥˜ ë°©ì§€
      const date = new Date(dateString);
      if (isNaN(date)) return dateString; // ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œëŠ” ì›ë³¸ ë¬¸ìì—´ ë°˜í™˜

      return date.toLocaleDateString('ko-KR', {
        year: 'numeric', month: '2-digit', day: '2-digit'
      });
    }

    // CSV ë‹¤ìš´ë¡œë“œ í—¬í¼
    function downloadCSV(filename, data) {
      const csvContent = "data:text/csv;charset=utf-8,\uFEFF" + data.map(e => e.join(",")).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }


    /* ==================== RTU ê´€ë¦¬ ë¡œì§ ==================== */

    function populateRtuSelects() {
      const options = rtuList.map(rtu => `<option value="${rtu.name}">${rtu.name} (${rtu.region})</option>`).join('');
      elements.inspectionRtuIdSelect.innerHTML = '<option value="">-- RTUë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>' + options;
      elements.repairRtuIdSelect.innerHTML = '<option value="">-- RTUë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>' + options;
      
      const modifyOptions = rtuList.map(rtu => `<option value="${rtu.name}">${rtu.name} (${rtu.region})</option>`).join('');
      elements.rtuModifySelect.innerHTML = '<option value="">-- ìˆ˜ì •í•  RTUë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>' + modifyOptions;
    }

    // RTU ë“±ë¡ ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜ (ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì¶”ê°€)
    function renderRtuItem(rtu) {
      const statusColor = getStatusColor(rtu.status);
      const firstImageUrl = rtu.imageUrl1; // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ ì¸ë„¤ì¼ë¡œ ì‚¬ìš©

      return `
        <div class="rtu-item bg-white p-4 rounded-lg shadow border border-gray-100 hover:shadow-md transition duration-150 flex justify-between items-center">
            <div class="flex items-center flex-grow min-w-0">
                ${firstImageUrl ? `<img src="${firstImageUrl}" alt="${rtu.name} Image" class="thumb mr-4 flex-shrink-0 cursor-pointer" onclick="zoomImage(this.src)">` : ''}
                <div class="flex-grow min-w-0">
                    <div class="flex items-center space-x-3 mb-1">
                        <span class="text-xl font-bold text-gray-800 truncate">${rtu.name}</span>
                        <span class="px-2 py-0.5 text-xs font-semibold rounded-full ${statusColor} flex-shrink-0">${rtu.status}</span>
                    </div>
                    <p class="text-sm text-gray-600 truncate mb-1">ì„¤ì¹˜ ì¥ì†Œ: ${rtu.region}</p>
                    <p class="text-xs text-gray-500 truncate">ëª¨ë¸: ${rtu.model || 'N/A'} | ìš©ëŸ‰: ${rtu.capacity || 'N/A'} | ì„¤ì¹˜ì¼: ${formatDate(rtu.date)}</p>
                </div>
            </div>
            <div class="flex items-center space-x-2 flex-shrink-0 ml-4">
                <button data-id="${rtu.name}" class="detail-btn bg-gray-200 text-gray-700 text-sm font-medium py-1 px-3 rounded-full hover:bg-gray-300 transition duration-150">ìƒì„¸</button>
                <button data-id="${rtu.name}" class="modify-rtu-btn bg-blue-500 text-white text-sm font-medium py-1 px-3 rounded-full hover:bg-blue-600 transition duration-150">ìˆ˜ì •</button>
                <button data-id="${rtu.name}" class="delete-rtu-btn bg-red-500 text-white text-sm font-medium py-1 px-3 rounded-full hover:bg-red-600 transition duration-150">ì‚­ì œ</button>
            </div>
        </div>
      `;
    }

    function renderRtuList(page) {
      const sortedList = rtuList.sort((a, b) => new Date(b.lastUpdated || b.date) - new Date(a.lastUpdated || a.date));
      const totalPages = Math.ceil(sortedList.length / PAGE_SIZE);
      const startIndex = (page - 1) * PAGE_SIZE;
      const paginatedList = sortedList.slice(startIndex, startIndex + PAGE_SIZE);

      elements.rtuCount.textContent = sortedList.length;
      
      if (paginatedList.length === 0) {
        elements.rtuListContainer.innerHTML = '<p class="text-gray-500 italic p-4">ë“±ë¡ëœ RTU ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        elements.rtuPaginationContainer.innerHTML = '';
        return;
      }

      elements.rtuListContainer.innerHTML = paginatedList.map(renderRtuItem).join('');
      renderPagination(elements.rtuPaginationContainer, totalPages, page, (p) => {
        rtuCurrentPage = p;
        renderRtuList(rtuCurrentPage);
      });

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬í• ë‹¹
      document.querySelectorAll('.detail-btn').forEach(btn => btn.addEventListener('click', (e) => showDetailModal(e.target.dataset.id, 'rtu')));
      document.querySelectorAll('.modify-rtu-btn').forEach(btn => btn.addEventListener('click', (e) => loadRtuForModification(e.target.dataset.id)));
      document.querySelectorAll('.delete-rtu-btn').forEach(btn => btn.addEventListener('click', (e) => handleDeleteRtu(e.target.dataset.id)));
    }
    
    // RTU ë“±ë¡/ìˆ˜ì • í¼ í•¸ë“¤ëŸ¬
    elements.rtuForm.addEventListener('submit', handleRtuFormSubmit);
    
    // ìˆ˜ì • ëª¨ë“œ ë³€ê²½ í•¸ë“¤ëŸ¬
    elements.modeNewBtn.addEventListener('click', () => switchRtuMode('new'));
    elements.modeModifyBtn.addEventListener('click', () => switchRtuMode('modify'));
    elements.rtuModifySelect.addEventListener('change', (e) => {
      const rtuId = e.target.value;
      if (rtuId) {
        fillRtuForm(rtuId);
      } else {
        resetRtuForm(false);
      }
    });

    /* ==================== ì ê²€ ê¸°ë¡ ë¡œì§ ==================== */

    function renderInspectionItem(inspection) {
      const rtuInfo = getRtuInfo(inspection.rtuId);
      const statusColor = getStatusColor(rtuInfo.status);
      const resultColor = inspection.result === 'ì •ìƒ' ? 'bg-green-100 text-green-800' : 
                          inspection.result === 'ì£¼ì˜' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';

      return `
        <div class="inspection-item bg-white p-4 rounded-lg shadow border border-gray-100 hover:shadow-md transition duration-150">
          <div class="flex items-center space-x-3 mb-2">
            <span class="text-lg font-bold text-gray-800">${rtuInfo.name}</span>
            <span class="px-2 py-0.5 text-xs font-semibold rounded-full ${statusColor}">${rtuInfo.status}</span>
          </div>
          <p class="text-sm text-gray-600 mb-1">ì ê²€ ë‚ ì§œ: ${formatDate(inspection.inspectionDate)} | ì ê²€ì: ${inspection.inspector}</p>
          <div class="flex items-center space-x-2 mt-2">
            <span class="px-2 py-0.5 text-xs font-semibold rounded ${resultColor}">ê²°ê³¼: ${inspection.result}</span>
            <button data-id="${inspection.id}" class="detail-btn bg-gray-200 text-gray-700 text-xs font-medium py-1 px-3 rounded-full hover:bg-gray-300 transition duration-150">ìƒì„¸ ë³´ê¸°</button>
          </div>
        </div>
      `;
    }

    function renderInspectionList(page) {
      const sortedList = inspectionList.sort((a, b) => new Date(b.inspectionDate) - new Date(a.inspectionDate));
      const totalPages = Math.ceil(sortedList.length / PAGE_SIZE);
      const startIndex = (page - 1) * PAGE_SIZE;
      const paginatedList = sortedList.slice(startIndex, startIndex + PAGE_SIZE);

      elements.inspectionCount.textContent = sortedList.length;

      if (paginatedList.length === 0) {
        elements.inspectionListContainer.innerHTML = '<p class="text-gray-500 italic p-4">ë“±ë¡ëœ ì ê²€ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        elements.inspectionPaginationContainer.innerHTML = '';
        return;
      }

      elements.inspectionListContainer.innerHTML = paginatedList.map(renderInspectionItem).join('');
      renderPagination(elements.inspectionPaginationContainer, totalPages, page, (p) => {
        inspectionCurrentPage = p;
        renderInspectionList(inspectionCurrentPage);
      });

      document.querySelectorAll('#inspection-list .detail-btn').forEach(btn => btn.addEventListener('click', (e) => showDetailModal(e.target.dataset.id, 'inspection')));
    }

    // ì ê²€ ê¸°ë¡ í¼ í•¸ë“¤ëŸ¬
    elements.inspectionForm.addEventListener('submit', handleInspectionFormSubmit);

    /* ==================== ìˆ˜ë¦¬ ê¸°ë¡ ë¡œì§ ==================== */

    function renderRepairItem(repair) {
      const rtuInfo = getRtuInfo(repair.rtuId);
      const rtuStatusColor = getStatusColor(rtuInfo.status);
      let repairStatusColor;
      
      switch(repair.status) {
        case 'ìš”ì²­':
          repairStatusColor = 'bg-red-100 text-red-800';
          break;
        case 'ì§„í–‰ì¤‘':
          repairStatusColor = 'bg-yellow-100 text-yellow-800';
          break;
        case 'ì™„ë£Œ':
          repairStatusColor = 'bg-green-100 text-green-800';
          break;
        default:
          repairStatusColor = 'bg-gray-100 text-gray-800';
      }

      return `
        <div class="repair-item bg-white p-4 rounded-lg shadow border border-gray-100 hover:shadow-md transition duration-150">
          <div class="flex items-center space-x-3 mb-2">
            <span class="text-lg font-bold text-gray-800">${rtuInfo.name}</span>
            <span class="px-2 py-0.5 text-xs font-semibold rounded-full ${rtuStatusColor}">${rtuInfo.status}</span>
          </div>
          <p class="text-sm text-gray-600 mb-1">ë‚ ì§œ: ${formatDate(repair.repairDate)} | ë‹´ë‹¹ì: ${repair.engineer}</p>
          <div class="flex items-center space-x-2 mt-2">
            <span class="px-2 py-0.5 text-xs font-semibold rounded ${repairStatusColor}">ì²˜ë¦¬ ìƒíƒœ: ${repair.status}</span>
            <button data-id="${repair.id}" class="detail-btn bg-gray-200 text-gray-700 text-xs font-medium py-1 px-3 rounded-full hover:bg-gray-300 transition duration-150">ìƒì„¸ ë³´ê¸°</button>
          </div>
        </div>
      `;
    }

    function renderRepairList(page) {
      const sortedList = repairList.sort((a, b) => new Date(b.repairDate) - new Date(a.repairDate));
      const totalPages = Math.ceil(sortedList.length / PAGE_SIZE);
      const startIndex = (page - 1) * PAGE_SIZE;
      const paginatedList = sortedList.slice(startIndex, startIndex + PAGE_SIZE);

      elements.repairCount.textContent = sortedList.length;

      if (paginatedList.length === 0) {
        elements.repairListContainer.innerHTML = '<p class="text-gray-500 italic p-4">ë“±ë¡ëœ ìˆ˜ë¦¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        elements.repairPaginationContainer.innerHTML = '';
        return;
      }

      elements.repairListContainer.innerHTML = paginatedList.map(renderRepairItem).join('');
      renderPagination(elements.repairPaginationContainer, totalPages, page, (p) => {
        repairCurrentPage = p;
        renderRepairList(repairCurrentPage);
      });

      document.querySelectorAll('#repair-list .detail-btn').forEach(btn => btn.addEventListener('click', (e) => showDetailModal(e.target.dataset.id, 'repair')));
    }

    // ìˆ˜ë¦¬ ê¸°ë¡ í¼ í•¸ë“¤ëŸ¬
    elements.repairForm.addEventListener('submit', handleRepairFormSubmit);


    /* ==================== ê³µí†µ í•¨ìˆ˜ (Pagination, Modal, Dashboard) ==================== */

    function renderPagination(container, totalPages, currentPage, pageChangeHandler) {
      container.innerHTML = '';
      if (totalPages <= 1) return;

      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

      if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }

      const createButton = (text, page, isDisabled) => {
        const btn = document.createElement('button');
        btn.textContent = text;
        btn.classList.add('pagination-btn', 'px-3', 'py-1', 'mx-1', 'text-sm', 'rounded-md', 'transition', 'duration-150');
        if (page === currentPage) {
          btn.classList.add('bg-blue-600', 'text-white', 'font-semibold');
        } else if (!isDisabled) {
          btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
          btn.addEventListener('click', () => pageChangeHandler(page));
        } else {
          btn.disabled = true;
        }
        return btn;
      };

      // Previous button
      container.appendChild(createButton('ì´ì „', currentPage - 1, currentPage === 1));

      // Page number buttons
      for (let i = startPage; i <= endPage; i++) {
        container.appendChild(createButton(i, i, false));
      }

      // Next button
      container.appendChild(createButton('ë‹¤ìŒ', currentPage + 1, currentPage === totalPages));
    }


    function updateDashboard() {
      // RTU Stats
      const totalRtu = rtuList.length;
      const running = rtuList.filter(rtu => rtu.status === 'ì‘ë™ì¤‘').length;
      const stopped = rtuList.filter(rtu => rtu.status === 'ì •ì§€ë¨').length;
      const needsInspection = rtuList.filter(rtu => rtu.status === 'ì ê²€í•„ìš”').length;

      elements.dashboardTotal.textContent = totalRtu;
      elements.dashboardRunning.textContent = running;
      elements.dashboardStopped.textContent = stopped;
      elements.dashboardNeedsInspection.textContent = needsInspection;

      // Monthly Inspection Count
      const now = new Date();
      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
      startOfMonth.setHours(0, 0, 0, 0);
      const monthlyInspectionCount = inspectionList.filter(inspection => new Date(inspection.inspectionDate) >= startOfMonth).length;
      elements.dashboardMonthlyInspection.textContent = monthlyInspectionCount;

      // Pending Repair Count
      const pendingRepairCount = repairList.filter(repair => repair.status === 'ìš”ì²­' || repair.status === 'ì§„í–‰ì¤‘').length;
      elements.dashboardPendingRepair.textContent = pendingRepairCount;

      // Latest RTU List
      const latestRtu = rtuList.sort((a, b) => new Date(b.lastUpdated || b.date) - new Date(a.lastUpdated || a.date)).slice(0, 5);
      if (latestRtu.length === 0) {
        elements.dashboardLatestList.innerHTML = '<p class="text-gray-500">ë“±ë¡ëœ ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      } else {
        elements.dashboardLatestList.innerHTML = latestRtu.map(rtu => `
          <div class="flex justify-between items-center py-2 border-b last:border-b-0">
            <span class="font-medium text-gray-700">${rtu.name} (${rtu.region})</span>
            <span class="px-2 py-0.5 text-xs font-semibold rounded ${getStatusColor(rtu.status)}">${rtu.status}</span>
          </div>
        `).join('');
      }

      // Report Page Update
      elements.reportTotalRtu.textContent = rtuList.length;
      elements.reportTotalInspection.textContent = inspectionList.length;
      elements.reportTotalRepair.textContent = repairList.length;
    }


    /* ==================== ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (í¼ ì œì¶œ, ì‚­ì œ, ëª¨ë‹¬) ==================== */

    async function handleRtuFormSubmit(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => { data[key] = value; });

      let rtuId = data.name;

      // ìˆ˜ì • ëª¨ë“œ ì²˜ë¦¬
      if (currentRtuMode === 'modify') {
        rtuId = elements.rtuIdForModification.value;
        if (!rtuId) {
          alert("ìˆ˜ì •í•  RTUë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
          return;
        }
        const existingRtu = rtuList.find(r => r.id === rtuId);
        if (existingRtu && existingRtu.name !== data.name) {
           // nameì´ ë³€ê²½ëœ ê²½ìš° (ì‚¬ìš©ì ì‹¤ìˆ˜ ë˜ëŠ” ì˜ë„ì ) ê²½ê³ 
           if (rtuList.some(r => r.name === data.name && r.id !== rtuId)) {
                alert("ê²½ê³ : RTU IDëŠ” ë³€ê²½í•  ìˆ˜ ì—†ìœ¼ë©°, ê¸°ì¡´ IDì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ë³€ê²½ ì—†ì´ ì €ì¥í•©ë‹ˆë‹¤.");
                data.name = existingRtu.name; // ê¸°ì¡´ ì´ë¦„ ìœ ì§€
            }
        }
        data.id = rtuId;
        data.lastUpdated = new Date().toISOString();
        const originalRtu = rtuList.find(r => r.id === rtuId);
        // ê¸°ì¡´ ì´ë¯¸ì§€ URLì„ ìœ ì§€í•˜ê±°ë‚˜, ìƒˆ íŒŒì¼ì´ ìˆìœ¼ë©´ ì—…ë¡œë“œëœ íŒŒì¼ì˜ dataURLì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        data.imageUrl1 = data.imageUrl1 && data.imageUrl1.size > 0 ? imageBase64Data.imageUrl1 : (originalRtu ? originalRtu.imageUrl1 : '');
        data.imageUrl2 = data.imageUrl2 && data.imageUrl2.size > 0 ? imageBase64Data.imageUrl2 : (originalRtu ? originalRtu.imageUrl2 : '');
        data.imageUrl3 = data.imageUrl3 && data.imageUrl3.size > 0 ? imageBase64Data.imageUrl3 : (originalRtu ? originalRtu.imageUrl3 : '');

        rtuList = rtuList.map(rtu => (rtu.id === rtuId ? { ...rtu, ...data } : rtu));
        alert("RTU ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
      } else {
        // ì‹ ê·œ ë“±ë¡ ëª¨ë“œ ì²˜ë¦¬
        if (rtuList.some(r => r.name === rtuId)) {
          alert("ì˜¤ë¥˜: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” RTU ë“±ë¡ë²ˆí˜¸/ID ì…ë‹ˆë‹¤.");
          return;
        }
        data.id = rtuId; // IDë¡œ name ì‚¬ìš© (Firebase í‚¤)
        data.date = data.date || new Date().toISOString().split('T')[0];
        data.lastUpdated = new Date().toISOString();
        data.imageUrl1 = imageBase64Data.imageUrl1;
        data.imageUrl2 = imageBase64Data.imageUrl2;
        data.imageUrl3 = imageBase64Data.imageUrl3;
        
        rtuList.push(data);
        alert("RTU ì¥ë¹„ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
      
      await saveToFirebase(STORAGE_KEYS.RTU, rtuList);
      resetRtuForm(true);
      switchRtuMode('new'); // ì €ì¥ í›„ ë“±ë¡ ëª¨ë“œë¡œ ì „í™˜
    }

    async function handleInspectionFormSubmit(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => { data[key] = value; });

      data.id = `insp_${Date.now()}`;
      inspectionList.push(data);

      await saveToFirebase(STORAGE_KEYS.INSPECTION, inspectionList);
      alert("ì ê²€ ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
      form.reset();
    }

    async function handleRepairFormSubmit(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => { data[key] = value; });

      data.id = `repair_${Date.now()}`;
      repairList.push(data);

      await saveToFirebase(STORAGE_KEYS.REPAIR, repairList);
      alert("ìˆ˜ë¦¬ ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
      form.reset();
    }

    async function handleDeleteRtu(rtuId) {
      if (confirm(`ì •ë§ë¡œ RTU '${rtuId}' ì¥ë¹„ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì ê²€/ìˆ˜ë¦¬ ê¸°ë¡ì€ ë³´ì¡´ë¨)`)) {
        await deleteRtu(rtuId);
        alert("RTU ì¥ë¹„ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        // Firebase onValue ì½œë°±ìœ¼ë¡œ ì¸í•´ ë¦¬ìŠ¤íŠ¸ëŠ” ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
      }
    }
    
    // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
    function showDetailModal(id, type) {
      currentModalData = { id, type };
      let data, title, contentHTML;

      if (type === 'rtu') {
        data = rtuList.find(r => r.name === id);
        if (!data) {
          title = "ì¥ë¹„ ì—†ìŒ";
          contentHTML = "<p>í•´ë‹¹ RTU ì¥ë¹„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
        } else {
            title = `RTU ìƒì„¸ ì •ë³´: ${data.name}`;
            contentHTML = `
              <p><strong>ë“±ë¡ë²ˆí˜¸/ID:</strong> ${data.name}</p>
              <p><strong>ì„¤ì¹˜ ì¥ì†Œ/ì§€ì—­:</strong> ${data.region}</p>
              <p><strong>í˜„ì¬ ìƒíƒœ:</strong> <span class="px-2 py-0.5 text-xs font-semibold rounded ${getStatusColor(data.status)}">${data.status}</span></p>
              <p><strong>ì„¤ì¹˜(ë“±ë¡) ë‚ ì§œ:</strong> ${formatDate(data.date)}</p>
              <p><strong>ëª¨ë¸ëª…:</strong> ${data.model || 'N/A'}</p>
              <p><strong>ìš©ëŸ‰:</strong> ${data.capacity || 'N/A'}</p>
              <p><strong>ìœ ë‹› ì¢…ë¥˜:</strong> ${data.unitType || 'N/A'}</p>
              <p><strong>ëƒ‰ë§¤ ì¢…ë¥˜:</strong> ${data.refrigerant || 'N/A'}</p>
              <p><strong>ì „ê¸° ì¢…ë¥˜:</strong> ${data.electricPhase || 'N/A'}</p>
              <p><strong>ê³ ì•• ìƒí•œ ì„¤ì • (PSI):</strong> ${data.pressureHighLimit || 'N/A'}</p>
              <p><strong>ì €ì•• í•˜í•œ ì„¤ì • (PSI):</strong> ${data.pressureLowLimit || 'N/A'}</p>
              <p class="mt-4"><strong>íŠ¹ì´ì‚¬í•­ ë° ë©”ëª¨:</strong></p>
              <p class="whitespace-pre-wrap border p-2 rounded-md bg-gray-50">${data.notes || 'ì—†ìŒ'}</p>
              <div class="mt-4 border-t pt-4">
                <p class="font-semibold">ì¥ë¹„ ì‚¬ì§„:</p>
                <div class="flex flex-wrap gap-3 mt-2">
                  ${data.imageUrl1 ? `<img src="${data.imageUrl1}" alt="Image 1" class="thumb-detail" onclick="zoomImage(this.src)">` : '<div class="thumb-detail bg-gray-200 flex items-center justify-center text-xs text-gray-500">ì‚¬ì§„ 1 ì—†ìŒ</div>'}
                  ${data.imageUrl2 ? `<img src="${data.imageUrl2}" alt="Image 2" class="thumb-detail" onclick="zoomImage(this.src)">` : '<div class="thumb-detail bg-gray-200 flex items-center justify-center text-xs text-gray-500">ì‚¬ì§„ 2 ì—†ìŒ</div>'}
                  ${data.imageUrl3 ? `<img src="${data.imageUrl3}" alt="Image 3" class="thumb-detail" onclick="zoomImage(this.src)">` : '<div class="thumb-detail bg-gray-200 flex items-center justify-center text-xs text-gray-500">ì‚¬ì§„ 3 ì—†ìŒ</div>'}
                </div>
              </div>
            `;
        }
      } else if (type === 'inspection') {
        data = inspectionList.find(i => i.id === id);
        if (!data) {
          title = "ì ê²€ ê¸°ë¡ ì—†ìŒ";
          contentHTML = "<p>í•´ë‹¹ ì ê²€ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
        } else {
            const rtuInfo = getRtuInfo(data.rtuId);
            title = `ì ê²€ ê¸°ë¡ ìƒì„¸ (RTU: ${rtuInfo.name})`;
            const resultColor = data.result === 'ì •ìƒ' ? 'bg-green-100 text-green-800' : 
                              data.result === 'ì£¼ì˜' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
            contentHTML = `
              <p><strong>ëŒ€ìƒ RTU:</strong> ${rtuInfo.name}</p>
              <p><strong>ì ê²€ ë‚ ì§œ:</strong> ${formatDate(data.inspectionDate)}</p>
              <p><strong>ì ê²€ì:</strong> ${data.inspector}</p>
              <p><strong>ìµœì¢… ì ê²€ ê²°ê³¼:</strong> <span class="px-2 py-0.5 text-sm font-semibold rounded ${resultColor}">${data.result}</span></p>
              
              <h4 class="text-md font-semibold mt-4 border-t pt-2">ë¶€í’ˆ ì ê²€ ìƒíƒœ</h4>
              <div class="grid grid-cols-2 gap-2 text-sm">
                <p><strong>1. í•„í„°:</strong> ${data.check1}</p>
                <p><strong>2. ì½˜í…í„°:</strong> ${data.check2}</p>
                <p><strong>3. ì½˜ë´ì‹± ì½”ì¼:</strong> ${data.check3}</p>
                <p><strong>4. ì†¡í’ ëª¨í„°:</strong> ${data.check4}</p>
                <p><strong>5. ì¦ë°œê¸° ì½”ì¼:</strong> ${data.check5}</p>
                <p><strong>6. ê³ ì•• ì„¼ì„œ:</strong> ${data.check6}</p>
                <p><strong>7. ì €ì•• ì„¼ì„œ:</strong> ${data.check7}</p>
                <p><strong>8. ìºíŒ¨ì‹œí„°:</strong> ${data.check8}</p>
              </div>
              
              <h4 class="text-md font-semibold mt-4 border-t pt-2">ìš´ì „ ìƒíƒœ ì¸¡ì •</h4>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="font-medium text-gray-700">Comp 1</p>
                  <p class="text-sm">ê³ ì••: ${data.comp1Hp || 'N/A'} PSI</p>
                  <p class="text-sm">ì €ì••: ${data.comp1Lp || 'N/A'} PSI</p>
                  <p class="text-sm">ì „ë¥˜: ${data.comp1Amp || 'N/A'} A</p>
                </div>
                <div>
                  <p class="font-medium text-gray-700">Comp 2</p>
                  <p class="text-sm">ê³ ì••: ${data.comp2Hp || 'N/A'} PSI</p>
                  <p class="text-sm">ì €ì••: ${data.comp2Lp || 'N/A'} PSI</p>
                  <p class="text-sm">ì „ë¥˜: ${data.comp2Amp || 'N/A'} A</p>
                </div>
              </div>

              <h4 class="text-md font-semibold mt-4 border-t pt-2">ì˜¨ë„ ì¸¡ì •</h4>
              <div class="grid grid-cols-2 gap-4">
                <p class="text-sm"><strong>ê³¼ì—´ë„:</strong> ${data.superheat || 'N/A'} â„‰</p>
                <p class="text-sm"><strong>ê³¼ëƒ‰ë„:</strong> ${data.subcool || 'N/A'} â„‰</p>
              </div>

              <p class="mt-4"><strong>íŠ¹ì´ì‚¬í•­ ë° ì¡°ì¹˜ ë‚´ìš©:</strong></p>
              <p class="whitespace-pre-wrap border p-2 rounded-md bg-gray-50">${data.notes || 'ì—†ìŒ'}</p>
            `;
        }
      } else if (type === 'repair') {
        data = repairList.find(r => r.id === id);
        if (!data) {
          title = "ìˆ˜ë¦¬ ê¸°ë¡ ì—†ìŒ";
          contentHTML = "<p>í•´ë‹¹ ìˆ˜ë¦¬ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
        } else {
            const rtuInfo = getRtuInfo(data.rtuId);
            title = `ìˆ˜ë¦¬ ê¸°ë¡ ìƒì„¸ (RTU: ${rtuInfo.name})`;
            let repairStatusColor;
            switch(data.status) {
              case 'ìš”ì²­':
                repairStatusColor = 'bg-red-100 text-red-800';
                break;
              case 'ì§„í–‰ì¤‘':
                repairStatusColor = 'bg-yellow-100 text-yellow-800';
                break;
              case 'ì™„ë£Œ':
                repairStatusColor = 'bg-green-100 text-green-800';
                break;
              default:
                repairStatusColor = 'bg-gray-100 text-gray-800';
            }
            contentHTML = `
              <p><strong>ëŒ€ìƒ RTU:</strong> ${rtuInfo.name}</p>
              <p><strong>ìˆ˜ë¦¬ ìš”ì²­/ì™„ë£Œ ë‚ ì§œ:</strong> ${formatDate(data.repairDate)}</p>
              <p><strong>ìˆ˜ë¦¬ ë‹´ë‹¹ì:</strong> ${data.engineer}</p>
              <p><strong>ì²˜ë¦¬ ìƒíƒœ:</strong> <span class="px-2 py-0.5 text-sm font-semibold rounded ${repairStatusColor}">${data.status}</span></p>
              <p class="mt-4"><strong>ë¬¸ì œ ë° ì¡°ì¹˜ ë‚´ìš©:</strong></p>
              <p class="whitespace-pre-wrap border p-2 rounded-md bg-gray-50">${data.issue || 'ì—†ìŒ'}</p>
            `;
        }
      } else {
        title = "ì˜¤ë¥˜";
        contentHTML = "<p>ìš”ì²­ëœ ë°ì´í„° íƒ€ì…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
      }

      elements.modalTitle.textContent = title;
      elements.modalContent.innerHTML = contentHTML;
      elements.detailModal.classList.remove('hidden');
    }
    
    // ì´ë¯¸ì§€ íŒŒì¼ ë¡œë“œ ë° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    document.getElementById('rtu-image1').addEventListener('change', (e) => handleImageUpload(e.target, elements.imagePreview1, 'imageUrl1'));
    document.getElementById('rtu-image2').addEventListener('change', (e) => handleImageUpload(e.target, elements.imagePreview2, 'imageUrl2'));
    document.getElementById('rtu-image3').addEventListener('change', (e) => handleImageUpload(e.target, elements.imagePreview3, 'imageUrl3'));

    async function handleImageUpload(input, previewElement, key) {
      if (input.files.length > 0) {
        try {
          const dataURL = await readFileAsDataURL(input.files[0]);
          imageBase64Data[key] = dataURL;
          previewElement.src = dataURL;
          previewElement.style.display = 'block';
          elements.imagePreviewContainer.classList.remove('hidden');
        } catch (error) {
          console.error("Error reading file:", error);
          alert("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      } else {
        imageBase64Data[key] = '';
        previewElement.src = '';
        previewElement.style.display = 'none';
      }
      if (!imageBase64Data.imageUrl1 && !imageBase64Data.imageUrl2 && !imageBase64Data.imageUrl3) {
        elements.imagePreviewContainer.classList.add('hidden');
      }
    }

    // RTU ëª¨ë“œ ì „í™˜ í•¨ìˆ˜
    function switchRtuMode(mode) {
      currentRtuMode = mode;
      
      if (mode === 'new') {
        elements.rtuFormTitle.textContent = 'RTU ì¥ë¹„ ì‹ ê·œ ë“±ë¡';
        elements.modeNewBtn.classList.remove('bg-gray-200', 'text-gray-700');
        elements.modeNewBtn.classList.add('bg-blue-600', 'text-white');
        elements.modeModifyBtn.classList.remove('bg-blue-600', 'text-white');
        elements.modeModifyBtn.classList.add('bg-gray-200', 'text-gray-700');
        
        document.getElementById('rtu-name').classList.remove('hidden');
        elements.rtuModifySelect.classList.add('hidden');
        document.getElementById('rtu-name').parentNode.classList.remove('hidden');
        
        elements.rtuSubmitBtn.textContent = 'RTU ì •ë³´ ì €ì¥';
        resetRtuForm(true);
      } else if (mode === 'modify') {
        elements.rtuFormTitle.textContent = 'RTU ì¥ë¹„ ì •ë³´ ìˆ˜ì •';
        elements.modeNewBtn.classList.remove('bg-blue-600', 'text-white');
        elements.modeNewBtn.classList.add('bg-gray-200', 'text-gray-700');
        elements.modeModifyBtn.classList.remove('bg-gray-200', 'text-gray-700');
        elements.modeModifyBtn.classList.add('bg-blue-600', 'text-white');

        document.getElementById('rtu-name').classList.add('hidden');
        elements.rtuModifySelect.classList.remove('hidden');
        document.getElementById('rtu-name').parentNode.classList.add('hidden');

        elements.rtuSubmitBtn.textContent = 'RTU ì •ë³´ ìˆ˜ì •';
        resetRtuForm(false); // í¼ ë¦¬ì…‹ (ì„ íƒëœ RTUê°€ ì—†ë‹¤ë©´ ë¹„ì–´ìˆìŒ)
      }
    }
    
    // RTU ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜í•˜ê³  ë°ì´í„° ë¡œë“œ
    function loadRtuForModification(rtuId) {
      switchRtuMode('modify');
      elements.rtuModifySelect.value = rtuId;
      fillRtuForm(rtuId);
      // RTU ëª©ë¡ íƒ­ì´ ì•„ë‹Œ ê²½ìš° RTU ê´€ë¦¬ íƒ­ìœ¼ë¡œ ì´ë™
      if (document.querySelector('.tab-btn[data-tab="rtu-manage"]').classList.contains('tab-active') === false) {
        showTab('rtu-manage');
      }
      
      // ìŠ¤í¬ë¡¤ì„ í¼ ìœ„ì¹˜ë¡œ ì´ë™
      elements.rtuForm.scrollIntoView({ behavior: 'smooth' });
    }

    // ì„ íƒëœ RTU ì •ë³´ë¡œ í¼ ì±„ìš°ê¸°
    function fillRtuForm(rtuId) {
      const rtu = rtuList.find(r => r.name === rtuId);
      if (!rtu) return;

      elements.rtuIdForModification.value = rtu.name; 
      
      // ì´ë¦„ í•„ë“œëŠ” ìˆ¨ê²¨ì ¸ ìˆì§€ë§Œ, ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ê¸°ì¡´ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤.
      document.getElementById('rtu-name').value = rtu.name; 

      document.getElementById('rtu-region').value = rtu.region || '';
      document.getElementById('rtu-model').value = rtu.model || '';
      document.getElementById('rtu-capacity').value = rtu.capacity || '';
      document.getElementById('rtu-unit-type').value = rtu.unitType || 'íŒ¨í‚¤ì§€';
      document.getElementById('rtu-refrigerant').value = rtu.refrigerant || 'R-410A';
      document.getElementById('rtu-electric-phase').value = rtu.electricPhase || 'ë‹¨ìƒ';
      document.getElementById('rtu-date').value = rtu.date || '';
      document.getElementById('rtu-status').value = rtu.status || 'ì‘ë™ì¤‘';
      document.getElementById('rtu-pressure-high').value = rtu.pressureHighLimit || '';
      document.getElementById('rtu-pressure-low').value = rtu.pressureLowLimit || '';
      document.getElementById('rtu-notes').value = rtu.notes || '';

      // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ì´ë¯¸ì§€ë¥¼ ìœ ì§€)
      imageBase64Data = { 
        imageUrl1: rtu.imageUrl1 || '', 
        imageUrl2: rtu.imageUrl2 || '', 
        imageUrl3: rtu.imageUrl3 || '' 
      };
      
      elements.imagePreview1.src = rtu.imageUrl1 || '';
      elements.imagePreview1.style.display = rtu.imageUrl1 ? 'block' : 'none';
      elements.imagePreview2.src = rtu.imageUrl2 || '';
      elements.imagePreview2.style.display = rtu.imageUrl2 ? 'block' : 'none';
      elements.imagePreview3.src = rtu.imageUrl3 || '';
      elements.imagePreview3.style.display = rtu.imageUrl3 ? 'block' : 'none';

      if (rtu.imageUrl1 || rtu.imageUrl2 || rtu.imageUrl3) {
        elements.imagePreviewContainer.classList.remove('hidden');
      } else {
        elements.imagePreviewContainer.classList.add('hidden');
      }
    }
    
    // RTU í¼ ë¦¬ì…‹
    function resetRtuForm(fullReset = true) {
      elements.rtuForm.reset();
      elements.rtuIdForModification.value = '';
      imageBase64Data = { imageUrl1: '', imageUrl2: '', imageUrl3: '' };

      elements.imagePreview1.src = '';
      elements.imagePreview2.src = '';
      elements.imagePreview3.src = '';
      elements.imagePreview1.style.display = 'none';
      elements.imagePreview2.style.display = 'none';
      elements.imagePreview3.style.display = 'none';
      elements.imagePreviewContainer.classList.add('hidden');
      
      if (fullReset) {
         // ì‹ ê·œ ë“±ë¡ ëª¨ë“œì¼ ë•Œë§Œ ì´ë¦„ í•„ë“œë¥¼ í™œì„±í™” (ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” ìˆ¨ê²¨ì§„ ìƒíƒœì—ì„œ ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ)
         document.getElementById('rtu-name').classList.remove('hidden');
         document.getElementById('rtu-name').parentNode.classList.remove('hidden');
         elements.rtuModifySelect.classList.add('hidden');
         elements.rtuModifySelect.value = '';
      } else {
        // ìˆ˜ì • ëª¨ë“œ ë¦¬ì…‹
        elements.rtuModifySelect.value = ''; // ì„ íƒ ë°•ìŠ¤ë§Œ ì´ˆê¸°í™”
      }
    }

    // íƒ­ ì „í™˜ ë¡œì§
    elements.tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetTab = btn.dataset.tab;
        showTab(targetTab);
      });
    });

    function showTab(targetTab) {
      elements.tabBtns.forEach(b => {
        b.classList.remove('tab-active', 'border-blue-500', 'text-blue-600');
        b.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
      });

      elements.tabPages.forEach(p => {
        p.classList.add('hidden');
      });

      const activeBtn = document.querySelector(`.tab-btn[data-tab="${targetTab}"]`);
      activeBtn.classList.add('tab-active', 'border-blue-500', 'text-blue-600');
      activeBtn.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

      document.getElementById(targetTab).classList.remove('hidden');

      // íƒ­ ì „í™˜ ì‹œ í•´ë‹¹ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ ìµœì‹  ìƒíƒœë¥¼ ë°˜ì˜
      if (targetTab === 'rtu-manage') {
        renderRtuList(rtuCurrentPage);
      } else if (targetTab === 'inspection-manage') {
        renderInspectionList(inspectionCurrentPage);
      } else if (targetTab === 'repair-manage') {
        renderRepairList(repairCurrentPage);
      } else if (targetTab === 'dashboard' || targetTab === 'report-page') {
        updateDashboard();
        // ë³´ê³ ì„œ íƒ­ìœ¼ë¡œ ì´ë™ ì‹œ ìƒì„¸ ëª©ë¡ ìˆ¨ê¸°ê¸°
        elements.reportDetailView.classList.add('hidden');
      }
    }

    // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
    elements.closeModalBtn.addEventListener('click', () => {
      elements.detailModal.classList.add('hidden');
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    elements.detailModal.addEventListener('click', (e) => {
      if (e.target.id === 'detail-modal') {
        elements.detailModal.classList.add('hidden');
      }
    });

    // ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬
    window.zoomImage = function(src) {
      elements.zoomedImage.src = src;
      elements.imageZoomModal.classList.remove('hidden');
    }

    // [ìˆ˜ì •] ë³´ê³ ì„œ ìƒì„¸ ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜ (print-only ì œê±°)
    function renderReportDetail(type) {
      elements.reportDetailView.classList.remove('hidden');
      
      let list = [];
      let title = '';
      let tableHTML = '';
      const currentDate = formatDate(new Date().toISOString().split('T')[0]);

      if (type === 'rtu') {
        list = rtuList.sort((a, b) => new Date(b.date) - new Date(a.date));
        title = `RTU ë“±ë¡ ëª©ë¡`;
        tableHTML = `
          <table class="w-full text-sm text-left text-gray-500 mt-4 border-collapse">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th scope="col" class="py-2 px-3 border-b">RTU ID</th>
                <th scope="col" class="py-2 px-3 border-b">ì„¤ì¹˜ ì§€ì—­</th>
                <th scope="col" class="py-2 px-3 border-b">í˜„ì¬ ìƒíƒœ</th>
                <th scope="col" class="py-2 px-3 border-b">ëª¨ë¸ëª…/ìš©ëŸ‰</th>
                <th scope="col" class="py-2 px-3 border-b">ì„¤ì¹˜ì¼</th>
                <th scope="col" class="py-2 px-3 border-b print-hidden">ìƒì„¸</th>
              </tr>
            </thead>
            <tbody>
              ${list.map(rtu => `
                <tr class="bg-white border-b hover:bg-gray-50">
                  <td class="py-2 px-3 font-medium text-gray-900 whitespace-nowrap">${rtu.name}</td>
                  <td class="py-2 px-3">${rtu.region}</td>
                  <td class="py-2 px-3"><span class="px-2 py-0.5 text-xs font-semibold rounded ${getStatusColor(rtu.status)}">${rtu.status}</span></td>
                  <td class="py-2 px-3">${rtu.model || 'N/A'} / ${rtu.capacity || 'N/A'}</td>
                  <td class="py-2 px-3">${formatDate(rtu.date)}</td>
                  <td class="py-2 px-3 print-hidden"><button data-id="${rtu.name}" data-type="rtu" class="report-detail-btn text-blue-600 hover:underline">ë³´ê¸°</button></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } else if (type === 'inspection') {
        list = inspectionList.sort((a, b) => new Date(b.inspectionDate) - new Date(a.inspectionDate));
        title = `ì ê²€ ê¸°ë¡ ëª©ë¡`;
        tableHTML = `
          <table class="w-full text-sm text-left text-gray-500 mt-4 border-collapse">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th scope="col" class="py-2 px-3 border-b">RTU ID</th>
                <th scope="col" class="py-2 px-3 border-b">ì ê²€ ë‚ ì§œ</th>
                <th scope="col" class="py-2 px-3 border-b">ì ê²€ì</th>
                <th scope="col" class="py-2 px-3 border-b">ìµœì¢… ê²°ê³¼</th>
                <th scope="col" class="py-2 px-3 border-b">ê³ ì••(PSI) / ì €ì••(PSI)</th>
                <th scope="col" class="py-2 px-3 border-b print-hidden">ìƒì„¸</th>
              </tr>
            </thead>
            <tbody>
              ${list.map(insp => {
                const rtuInfo = getRtuInfo(insp.rtuId);
                const resultColor = insp.result === 'ì •ìƒ' ? 'bg-green-100 text-green-800' : insp.result === 'ì£¼ì˜' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                return `
                <tr class="bg-white border-b hover:bg-gray-50">
                  <td class="py-2 px-3 font-medium text-gray-900 whitespace-nowrap">${rtuInfo.name}</td>
                  <td class="py-2 px-3">${formatDate(insp.inspectionDate)}</td>
                  <td class="py-2 px-3">${insp.inspector}</td>
                  <td class="py-2 px-3"><span class="px-2 py-0.5 text-xs font-semibold rounded ${resultColor}">${insp.result}</span></td>
                  <td class="py-2 px-3">${insp.comp1Hp || 'N/A'} / ${insp.comp1Lp || 'N/A'}</td>
                  <td class="py-2 px-3 print-hidden"><button data-id="${insp.id}" data-type="inspection" class="report-detail-btn text-blue-600 hover:underline">ë³´ê¸°</button></td>
                </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        `;
      } else if (type === 'repair') {
        list = repairList.sort((a, b) => new Date(b.repairDate) - new Date(a.repairDate));
        title = `ìˆ˜ë¦¬ ê¸°ë¡ ëª©ë¡`;
        tableHTML = `
          <table class="w-full text-sm text-left text-gray-500 mt-4 border-collapse">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th scope="col" class="py-2 px-3 border-b">RTU ID</th>
                <th scope="col" class="py-2 px-3 border-b">ìˆ˜ë¦¬ ë‚ ì§œ</th>
                <th scope="col" class="py-2 px-3 border-b">ë‹´ë‹¹ì</th>
                <th scope="col" class="py-2 px-3 border-b">ì²˜ë¦¬ ìƒíƒœ</th>
                <th scope="col" class="py-2 px-3 border-b">ë¬¸ì œ ìš”ì•½</th>
                <th scope="col" class="py-2 px-3 border-b print-hidden">ìƒì„¸</th>
              </tr>
            </thead>
            <tbody>
              ${list.map(repair => {
                const rtuInfo = getRtuInfo(repair.rtuId);
                let repairStatusColor;
                switch(repair.status) {
                  case 'ìš”ì²­': repairStatusColor = 'bg-red-100 text-red-800'; break;
                  case 'ì§„í–‰ì¤‘': repairStatusColor = 'bg-yellow-100 text-yellow-800'; break;
                  case 'ì™„ë£Œ': repairStatusColor = 'bg-green-100 text-green-800'; break;
                  default: repairStatusColor = 'bg-gray-100 text-gray-800';
                }
                return `
                <tr class="bg-white border-b hover:bg-gray-50">
                  <td class="py-2 px-3 font-medium text-gray-900 whitespace-nowrap">${rtuInfo.name}</td>
                  <td class="py-2 px-3">${formatDate(repair.repairDate)}</td>
                  <td class="py-2 px-3">${repair.engineer}</td>
                  <td class="py-2 px-3"><span class="px-2 py-0.5 text-xs font-semibold rounded ${repairStatusColor}">${repair.status}</span></td>
                  <td class="py-2 px-3 max-w-xs overflow-hidden truncate">${repair.issue ? repair.issue.substring(0, 30) + (repair.issue.length > 30 ? '...' : '') : 'ì—†ìŒ'}</td>
                  <td class="py-2 px-3 print-hidden"><button data-id="${repair.id}" data-type="repair" class="report-detail-btn text-blue-600 hover:underline">ë³´ê¸°</button></td>
                </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        `;
      } else {
        elements.reportDetailView.innerHTML = '<p class="text-red-500">ì˜ëª»ëœ ë³´ê³ ì„œ ìœ í˜•ì…ë‹ˆë‹¤.</p>';
        return;
      }
      
      // print-only <div>ë¥¼ ì œê±°í•˜ê³ , í™”ë©´ì—ì„œë§Œ ë³´ì—¬ì•¼ í•  ìš”ì†Œì— print-hidden ì¶”ê°€
      elements.reportDetailView.innerHTML = `
            <h3 class="text-2xl font-bold text-gray-800 mb-2">${title} (${list.length}ê±´)</h3>
            <div class="flex justify-between items-center mb-4 print-hidden">
                <p class="text-sm text-gray-600">ë°ì´í„° ê¸°ì¤€: ${currentDate}</p>
                <button id="print-report-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-150 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v2m-6 10v4m-2-4h4m4-4h2a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2"></path><path d="M17 9v2"></path></svg>
                    ë³´ê³ ì„œ ì¸ì‡„
                </button>
            </div>
            ${tableHTML}
            <div class="flex justify-center mt-6 print-hidden">
                <button id="hide-report-btn" class="text-gray-500 hover:text-gray-700 font-medium text-sm">ëª©ë¡ ë‹«ê¸°</button>
            </div>
      `;

      // ì¸ì‡„ ë° ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í• ë‹¹
      document.getElementById('print-report-btn').addEventListener('click', printReport);
      document.getElementById('hide-report-btn').addEventListener('click', () => {
        elements.reportDetailView.classList.add('hidden');
      });
      // ìƒì„¸ ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬í• ë‹¹
      document.querySelectorAll('.report-detail-btn').forEach(btn => btn.addEventListener('click', (e) => {
        const id = e.target.dataset.id;
        const detailType = e.target.dataset.type;
        showDetailModal(id, detailType);
      }));
    }

    // [ì‹ ê·œ] ì¸ì‡„ í•¨ìˆ˜
    function printReport() {
        window.print();
    }


    // CSV ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
    document.getElementById('download-data-btn').addEventListener('click', () => {
      if (confirm("RTU, ì ê²€, ìˆ˜ë¦¬ ë°ì´í„°ë¥¼ í¬í•¨í•œ ëª¨ë“  ë°ì´í„°ë¥¼ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        // 1. RTU ë°ì´í„°
        const rtuHeaders = ["ID", "ë“±ë¡ë²ˆí˜¸/ID", "ì„¤ì¹˜ ì¥ì†Œ/ì§€ì—­", "ëª¨ë¸ëª…", "ìš©ëŸ‰", "ìœ ë‹› ì¢…ë¥˜", "ëƒ‰ë§¤ ì¢…ë¥˜", "ì „ê¸° ì¢…ë¥˜", "ì„¤ì¹˜(ë“±ë¡) ë‚ ì§œ", "í˜„ì¬ ìƒíƒœ", "ê³ ì•• ìƒí•œ ì„¤ì •(PSI)", "ì €ì•• í•˜í•œ ì„¤ì •(PSI)", "íŠ¹ì´ì‚¬í•­ ë° ë©”ëª¨", "ì‚¬ì§„1 URL", "ì‚¬ì§„2 URL", "ì‚¬ì§„3 URL", "ìµœì¢… ìˆ˜ì •ì¼"];
        const rtuData = rtuList.map(rtu => [
          rtu.id, rtu.name, rtu.region, rtu.model, rtu.capacity, rtu.unitType, rtu.refrigerant, rtu.electricPhase, formatDate(rtu.date), rtu.status, rtu.pressureHighLimit, rtu.pressureLowLimit, rtu.notes ? rtu.notes.replace(/\n/g, ' ') : '', rtu.imageUrl1, rtu.imageUrl2, rtu.imageUrl3, rtu.lastUpdated
        ]);
        downloadCSV("rtu_data.csv", [rtuHeaders, ...rtuData]);

        // 2. ì ê²€ ê¸°ë¡ ë°ì´í„°
        const inspectionHeaders = ["ID", "ëŒ€ìƒ RTU ID", "ì ê²€ ë‚ ì§œ", "ì ê²€ì", "í•„í„°", "ì½˜í…í„°", "ì½˜ë´ì‹± ì½”ì¼", "ì†¡í’ ëª¨í„°", "ì¦ë°œê¸° ì½”ì¼", "ê³ ì•• ì„¼ì„œ", "ì €ì•• ì„¼ì„œ", "ìºíŒ¨ì‹œí„°", "Comp1 ê³ ì••(PSI)", "Comp1 ì €ì••(PSI)", "Comp1 ì „ë¥˜(A)", "Comp2 ê³ ì••(PSI)", "Comp2 ì €ì••(PSI)", "Comp2 ì „ë¥˜(A)", "ê³¼ì—´ë„(F)", "ê³¼ëƒ‰ë„(F)", "ìµœì¢… ì ê²€ ê²°ê³¼", "íŠ¹ì´ì‚¬í•­ ë° ì¡°ì¹˜ ë‚´ìš©"];
        const inspectionData = inspectionList.map(insp => [
          insp.id, insp.rtuId, formatDate(insp.inspectionDate), insp.inspector, insp.check1, insp.check2, insp.check3, insp.check4, insp.check5, insp.check6, insp.check7, insp.check8, insp.comp1Hp, insp.comp1Lp, insp.comp1Amp, insp.comp2Hp, insp.comp2Lp, insp.comp2Amp, insp.superheat, insp.subcool, insp.result, insp.notes ? insp.notes.replace(/\n/g, ' ') : ''
        ]);
        downloadCSV("inspection_data.csv", [inspectionHeaders, ...inspectionData]);

        // 3. ìˆ˜ë¦¬ ê¸°ë¡ ë°ì´í„°
        const repairHeaders = ["ID", "ëŒ€ìƒ RTU ID", "ìˆ˜ë¦¬ ìš”ì²­/ì™„ë£Œ ë‚ ì§œ", "ìˆ˜ë¦¬ ë‹´ë‹¹ì", "ì²˜ë¦¬ ìƒíƒœ", "ë¬¸ì œ ë° ì¡°ì¹˜ ë‚´ìš©"];
        const repairData = repairList.map(repair => [
          repair.id, repair.rtuId, formatDate(repair.repairDate), repair.engineer, repair.status, repair.issue ? repair.issue.replace(/\n/g, ' ') : ''
        ]);
        downloadCSV("repair_data.csv", [repairHeaders, ...repairData]);

        alert("ëª¨ë“  ë°ì´í„° ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    });

    // CSV ì—…ë¡œë“œ ê¸°ëŠ¥ (ê°„ì†Œí™”ëœ ë¡œì§, ì‹¤ì œ êµ¬í˜„ ì‹œ ë” ë³µì¡í•œ íŒŒì‹± ë° ìœ íš¨ì„± ê²€ì‚¬ í•„ìš”)
    document.getElementById('csv-upload').addEventListener('change', async (e) => {
      const files = e.target.files;
      if (files.length === 0) return;

      if (!confirm(`ì´ ${files.length}ê°œì˜ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë°ì´í„°ë¥¼ ëŒ€ì²´/ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë°ì´í„° ìœ íš¨ì„±ì— ë”°ë¼ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`)) {
        e.target.value = ''; // íŒŒì¼ ì„ íƒ ì·¨ì†Œ
        return;
      }
      
      const filePromises = Array.from(files).map(file => readFileAsText(file).then(text => ({ name: file.name, content: text })));
      const results = await Promise.all(filePromises);

      let rtuUpdated = false;
      let inspectionUpdated = false;
      let repairUpdated = false;

      results.forEach(result => {
        const lines = result.content.split('\n').filter(line => line.trim() !== '');
        if (lines.length < 2) return; 

        // í—¤ë” íŒŒì‹± (ì‰¼í‘œë¡œ ë¶„ë¦¬í•˜ê³  ë”°ì˜´í‘œ ì œê±°)
        const headers = parseCSVLine(lines[0]);
        const dataLines = lines.slice(1);
        
        let targetList = [];
        let keyField = '';
        let listKey = '';

        if (result.name.includes('rtu_data')) {
          targetList = rtuList;
          keyField = 'ID';
          listKey = STORAGE_KEYS.RTU;
          rtuUpdated = true;
        } else if (result.name.includes('inspection_data')) {
          targetList = inspectionList;
          keyField = 'ID';
          listKey = STORAGE_KEYS.INSPECTION;
          inspectionUpdated = true;
        } else if (result.name.includes('repair_data')) {
          targetList = repairList;
          keyField = 'ID';
          listKey = STORAGE_KEYS.REPAIR;
          repairUpdated = true;
        } else {
          console.warn(`Skipping unknown file: ${result.name}`);
          return;
        }
        
        // ë°ì´í„° ë ˆì½”ë“œ íŒŒì‹±
        dataLines.forEach(line => {
          const values = parseCSVLine(line);
          if (values.length !== headers.length) return;

          const record = {};
          headers.forEach((header, index) => {
            record[convertHeaderToKey(header)] = values[index];
          });
          
          if (record.id) {
             const existingIndex = targetList.findIndex(item => item.id === record.id);
             if (existingIndex !== -1) {
                // ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸
                targetList[existingIndex] = record;
             } else {
                // ìƒˆ ë°ì´í„° ì¶”ê°€
                targetList.push(record);
             }
          }
        });
        
        // Firebaseì— ì €ì¥ (ì‹¤ì‹œê°„ ë™ê¸°í™”ë¡œ ì¸í•´ onValue ì½œë°±ì´ ë¦¬ë Œë”ë§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤)
        saveToFirebase(listKey, targetList); 
      });

      if (rtuUpdated || inspectionUpdated || repairUpdated) {
         alert("CSV ë°ì´í„° ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í™”ë©´ì— ë°˜ì˜ë˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      } else {
         alert("ì²˜ë¦¬í•  ìœ íš¨í•œ ë°ì´í„° íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.");
      }

      e.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
    });

    function readFileAsText(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (event) => resolve(event.target.result);
        reader.onerror = (error) => reject(error);
        reader.readAsText(file, 'utf-8');
      });
    }

    function parseCSVLine(line) {
        // ê°„ë‹¨í•œ CSV íŒŒì„œ: ì‰¼í‘œë¡œ ë¶„ë¦¬í•˜ë˜, í°ë”°ì˜´í‘œ ì•ˆì˜ ì‰¼í‘œëŠ” ë¬´ì‹œí•˜ê³ , ë”°ì˜´í‘œë¥¼ ì œê±°í•©ë‹ˆë‹¤.
        const result = [];
        let inQuotes = false;
        let currentField = '';
        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            
            if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                result.push(currentField.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                currentField = '';
            } else {
                currentField += char;
            }
        }
        result.push(currentField.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
        return result;
    }

    function convertHeaderToKey(header) {
      switch (header.trim()) {
        case "ID": return "id";
        case "ë“±ë¡ë²ˆí˜¸/ID": return "name";
        case "ì„¤ì¹˜ ì¥ì†Œ/ì§€ì—­": return "region";
        case "ëª¨ë¸ëª…": return "model";
        case "ìš©ëŸ‰": return "capacity";
        case "ìœ ë‹› ì¢…ë¥˜": return "unitType";
        case "ëƒ‰ë§¤ ì¢…ë¥˜": return "refrigerant";
        case "ì „ê¸° ì¢…ë¥˜": return "electricPhase";
        case "ì„¤ì¹˜(ë“±ë¡) ë‚ ì§œ": return "date";
        case "í˜„ì¬ ìƒíƒœ": return "status";
        case "ê³ ì•• ìƒí•œ ì„¤ì •(PSI)": return "pressureHighLimit";
        case "ì €ì•• í•˜í•œ ì„¤ì •(PSI)": return "pressureLowLimit";
        case "íŠ¹ì´ì‚¬í•­ ë° ë©”ëª¨": return "notes";
        case "ì‚¬ì§„1 URL": return "imageUrl1";
        case "ì‚¬ì§„2 URL": return "imageUrl2";
        case "ì‚¬ì§„3 URL": return "imageUrl3";
        case "ìµœì¢… ìˆ˜ì •ì¼": return "lastUpdated";
        case "ëŒ€ìƒ RTU ID": return "rtuId";
        case "ì ê²€ ë‚ ì§œ": return "inspectionDate";
        case "ì ê²€ì": return "inspector";
        case "í•„í„°": return "check1";
        case "ì½˜í…í„°": return "check2";
        case "ì½˜ë´ì‹± ì½”ì¼": return "check3";
        case "ì†¡í’ ëª¨í„°": return "check4";
        case "ì¦ë°œê¸° ì½”ì¼": return "check5";
        case "ê³ ì•• ì„¼ì„œ": return "check6";
        case "ì €ì•• ì„¼ì„œ": return "check7";
        case "ìºíŒ¨ì‹œí„°": return "check8";
        case "Comp1 ê³ ì••(PSI)": return "comp1Hp";
        case "Comp1 ì €ì••(PSI)": return "comp1Lp";
        case "Comp1 ì „ë¥˜(A)": return "comp1Amp";
        case "Comp2 ê³ ì••(PSI)": return "comp2Hp";
        case "Comp2 ì €ì••(PSI)": return "comp2Lp";
        case "Comp2 ì „ë¥˜(A)": return "comp2Amp";
        case "ê³¼ì—´ë„(F)": return "superheat";
        case "ê³¼ëƒ‰ë„(F)": return "subcool";
        case "ìµœì¢… ì ê²€ ê²°ê³¼": return "result";
        case "ìˆ˜ë¦¬ ìš”ì²­/ì™„ë£Œ ë‚ ì§œ": return "repairDate";
        case "ìˆ˜ë¦¬ ë‹´ë‹¹ì": return "engineer";
        case "ì²˜ë¦¬ ìƒíƒœ": return "status";
        case "ë¬¸ì œ ë° ì¡°ì¹˜ ë‚´ìš©": return "issue";
        default:
          return header.trim().toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase());
      }
    }


    /* ==================== ì´ˆê¸°í™” ==================== */

    // ëª¨ë“  ë¦¬ìŠ¤íŠ¸ë¥¼ ë Œë”ë§í•˜ê³  ëŒ€ì‹œë³´ë“œë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    loadFromFirebase().then(() => {
      renderRtuList(rtuCurrentPage);
      renderInspectionList(inspectionCurrentPage);
      renderRepairList(repairCurrentPage);
      populateRtuSelects();
      updateDashboard();

      // [ì‹ ê·œ] ë³´ê³ ì„œ ìš”ì•½ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      elements.reportRtuSummary.addEventListener('click', () => {
        elements.reportDetailView.classList.remove('hidden');
        renderReportDetail('rtu');
      });
      elements.reportInspectionSummary.addEventListener('click', () => {
        elements.reportDetailView.classList.remove('hidden');
        renderReportDetail('inspection');
      });
      elements.reportRepairSummary.addEventListener('click', () => {
        elements.reportDetailView.classList.remove('hidden');
        renderReportDetail('repair');
      });

    }).catch(console.error);
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ íƒ­ í™œì„±í™” (ëŒ€ì‹œë³´ë“œ)ëŠ” HTML êµ¬ì¡°ë¡œ ì´ë¯¸ ì²˜ë¦¬ë¨
  </script>
</body>
</html>