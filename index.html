<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RTU 통합 관리 시스템 (로컬 저장소 - 최종)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background:#f3f4f6; }
    .thumb { width:96px; height:72px; object-fit:cover; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.08); }
    .hidden-file { position:absolute; left:-9999px; }
    .modal-bg { background: rgba(17,24,39,0.6); }
    /* 활성화된 탭 스타일 */
    .tab-active { border-color: #3b82f6 !important; color: #3b82f6; font-weight: 600; }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-6xl mx-auto p-4 sm:p-8">
    <div class="bg-white rounded-2xl shadow-xl p-6">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4 border-b pb-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">RTU 통합 관리 시스템</h1>
          <p class="text-sm text-gray-500">데이터는 **브라우저에 로컬로 저장**됩니다.</p>
        </div>
        <span id="user-display" class="font-semibold text-gray-700">로컬 사용자</span>
      </div>

      <div class="flex border-b border-gray-200 mb-6 overflow-x-auto whitespace-nowrap">
        <button data-tab="dashboard" class="tab-btn py-2 px-4 text-gray-600 border-b-2 border-transparent hover:border-blue-300 transition duration-150 tab-active border-blue-500">
          대시보드 (Dashboard)
        </button>
        <button data-tab="rtu-manage" class="tab-btn py-2 px-4 text-gray-600 border-b-2 border-transparent hover:border-blue-300 transition duration-150">
          장비 등록/관리
        </button>
        <button data-tab="inspection-manage" class="tab-btn py-2 px-4 text-gray-600 border-b-2 border-transparent hover:border-blue-300 transition duration-150">
          점검 등록/관리
        </button>
        <button data-tab="repair-manage" class="tab-btn py-2 px-4 text-gray-600 border-b-2 border-transparent hover:border-blue-300 transition duration-150">
          수리 등록/관리
        </button>
        <button data-tab="report-page" class="tab-btn py-2 px-4 text-gray-600 border-b-2 border-transparent hover:border-blue-300 transition duration-150">
          보고서 (Report)
        </button>
      </div>

      <div id="tab-content">
        
        <div id="dashboard" class="tab-page">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">장비 상태 및 처리 현황 요약</h2>
          
          <h3 class="text-xl font-medium text-gray-700 mb-3">장비 상태 요약</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-blue-100 text-blue-800 p-4 rounded-xl shadow-md">
              <p class="text-sm">등록된 장비 수</p>
              <p id="dashboard-total" class="text-2xl font-bold mt-1">0</p>
            </div>
            <div class="bg-green-100 text-green-800 p-4 rounded-xl shadow-md">
              <p class="text-sm">작동 중 (Running)</p>
              <p id="dashboard-running" class="text-2xl font-bold mt-1">0</p>
            </div>
            <div class="bg-gray-100 text-gray-800 p-4 rounded-xl shadow-md">
              <p class="text-sm">정지됨 (Stopped)</p>
              <p id="dashboard-stopped" class="text-2xl font-bold mt-1">0</p>
            </div>
            <div class="bg-red-100 text-red-800 p-4 rounded-xl shadow-md">
              <p class="text-sm">점검 필요 (Needs Insp.)</p>
              <p id="dashboard-needs-inspection" class="text-2xl font-bold mt-1">0</p>
            </div>
          </div>

          <h3 class="text-xl font-medium text-gray-700 mb-3 border-t pt-4">처리 현황</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-yellow-100 text-yellow-800 p-4 rounded-xl shadow-md">
              <p class="text-sm">이번 달 점검 건수</p>
              <p id="dashboard-monthly-inspection" class="text-2xl font-bold mt-1">0</p>
            </div>
            <div class="bg-purple-100 text-purple-800 p-4 rounded-xl shadow-md">
              <p class="text-sm">미처리 수리 요청</p>
              <p id="dashboard-pending-repair" class="text-2xl font-bold mt-1">0</p>
            </div>
          </div>
          
          <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">개별 장비 상태 (최근 활동 5건)</h3>
          <div id="dashboard-latest-list" class="space-y-4">
            <p class="text-gray-500 italic">로딩 중...</p>
          </div>
        </div>

        <div id="rtu-manage" class="tab-page hidden mb-40"> <div class="flex space-x-2 mb-4">
                <button id="mode-new-btn" class="py-2 px-4 rounded-lg font-semibold bg-blue-600 text-white shadow-md transition duration-150" onclick="switchRtuMode('new')">
                    신규 등록
                </button>
                <button id="mode-modify-btn" class="py-2 px-4 rounded-lg font-semibold bg-gray-200 text-gray-700 shadow-md transition duration-150" onclick="switchRtuMode('modify')">
                    장비 수정
                </button>
            </div>

            <form id="rtu-form" class="bg-gray-50 p-4 rounded-lg shadow-inner mb-6 space-y-4">
                <h2 id="rtu-form-title" class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">RTU 장비 신규 등록</h2>
                
                <input type="hidden" id="rtu-id-for-modification" name="rtuId" value=""> 

                <div id="rtu-id-container">
                    <div>
                        <label for="rtu-name" class="block text-sm font-medium text-gray-700">RTU 등록번호/ID *</label>
                        <input type="text" id="rtu-name" name="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="rtu-region" class="block text-sm font-medium text-gray-700">설치 장소/지역</label>
                        <input type="text" id="rtu-region" name="region" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div>
                        <label for="rtu-model" class="block text-sm font-medium text-gray-700">모델명</label>
                        <input type="text" id="rtu-model" name="model" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="rtu-capacity" class="block text-sm font-medium text-gray-700">용량</label>
                        <input type="text" id="rtu-capacity" name="capacity" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="rtu-unit-type" class="block text-sm font-medium text-gray-700">유닛 유형</label>
                        <input type="text" id="rtu-unit-type" name="unitType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="rtu-refrigerant" class="block text-sm font-medium text-gray-700">냉매 종류</label>
                        <input type="text" id="rtu-refrigerant" name="refrigerant" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    <div>
                        <label for="rtu-status" class="block text-sm font-medium text-gray-700">현재 상태 *</label>
                        <select id="rtu-status" name="status" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                            <option value="작동중">작동 중 (Running)</option>
                            <option value="정지됨">정지됨 (Stopped)</option>
                            <option value="점검필요">점검 필요 (Needs Inspection)</option>
                        </select>
                    </div>
                    <div>
                        <label for="rtu-electric-phase" class="block text-sm font-medium text-gray-700">전기 종류</label>
                        <select id="rtu-electric-phase" name="electricPhase" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                            <option value="단상">단상 (Single Phase)</option>
                            <option value="삼상">삼상 (Three Phase)</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>
                    <div>
                        <label for="rtu-date" class="block text-sm font-medium text-gray-700">설치 날짜</label>
                        <input type="date" id="rtu-date" name="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                </div>

                <h3 class="text-base font-semibold text-gray-700 border-t pt-4 mt-4">압력 상/하한 설정 (PSI)</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="rtu-pressure-high" class="block text-sm font-medium text-gray-700">고압 상한 (PSI)</label>
                        <input type="number" id="rtu-pressure-high" name="pressureHighLimit" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                    <div>
                        <label for="rtu-pressure-low" class="block text-sm font-medium text-gray-700">저압 하한 (PSI)</label>
                        <input type="number" id="rtu-pressure-low" name="pressureLowLimit" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                </div>

                <h3 class="text-base font-semibold text-gray-700 border-t pt-4 mt-4">장비 사진 등록 (최대 3장)</h3>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <input type="file" id="rtu-image-1" name="image1" accept="image/*" class="hidden-file" onchange="previewImage(event, 1)">
                        <button type="button" onclick="document.getElementById('rtu-image-1').click()" class="w-full bg-white border border-gray-300 rounded-md shadow-sm p-2 text-gray-700 hover:bg-gray-100">사진 1 선택</button>
                    </div>
                    <div>
                        <input type="file" id="rtu-image-2" name="image2" accept="image/*" class="hidden-file" onchange="previewImage(event, 2)">
                        <button type="button" onclick="document.getElementById('rtu-image-2').click()" class="w-full bg-white border border-gray-300 rounded-md shadow-sm p-2 text-gray-700 hover:bg-gray-100">사진 2 선택</button>
                    </div>
                    <div>
                        <input type="file" id="rtu-image-3" name="image3" accept="image/*" class="hidden-file" onchange="previewImage(event, 3)">
                        <button type="button" onclick="document.getElementById('rtu-image-3').click()" class="w-full bg-white border border-gray-300 rounded-md shadow-sm p-2 text-gray-700 hover:bg-gray-100">사진 3 선택</button>
                    </div>
                </div>
                
                <div id="image-preview-container" class="mt-2 hidden flex gap-4">
                    <p class="text-sm font-medium text-gray-700 mb-1">미리보기:</p>
                    <img id="image-preview-1" class="max-h-24 rounded-lg border border-gray-200" alt="사진 1 미리보기"/>
                    <img id="image-preview-2" class="max-h-24 rounded-lg border border-gray-200" alt="사진 2 미리보기"/>
                    <img id="image-preview-3" class="max-h-24 rounded-lg border border-gray-200" alt="사진 3 미리보기"/>
                </div>

                <div class="mt-4">
                <label for="rtu-notes" class="block text-sm font-medium text-gray-700">기타 메모 (특이사항)</label>
                <textarea id="rtu-notes" name="notes" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border"></textarea>
                </div>

                <button type="submit" id="rtu-submit-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-150 shadow-md">RTU 정보 저장</button>
            </form>

            <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">등록된 RTU 목록 (<span id="rtu-count">0</span>건)</h2>
            <div id="rtu-list" class="space-y-4">
                </div>
            
        </div>

        <div id="inspection-manage" class="tab-page hidden">
            <form id="inspection-form" class="bg-gray-50 p-4 rounded-lg shadow-inner mb-6 space-y-4">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">RTU 성능 점검 등록</h2>
                <div>
                    <label for="inspection-rtu-id" class="block text-sm font-medium text-gray-700">대상 RTU *</label>
                    <select id="inspection-rtu-id" name="rtuId" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                        <option value="">-- RTU를 선택하세요 --</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label for="inspection-date" class="block text-sm font-medium text-gray-700">점검 날짜 *</label>
                        <input type="date" id="inspection-date" name="inspectionDate" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                    <div class="sm:col-span-2">
                        <label for="inspection-inspector" class="block text-sm font-medium text-gray-700">점검자 이름 *</label>
                        <input type="text" id="inspection-inspector" name="inspector" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                </div>
                
                <h3 class="text-base font-semibold text-gray-700 border-t pt-4 mt-4">부품 체크 (양호 / 불량 / 재점검 요망)</h3>
                <div class="space-y-1 p-3 border rounded-lg bg-white">
                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">필터</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check1" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check1" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check1" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">콘텍터</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check2" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check2" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check2" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">콘덴싱 코일</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check3" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check3" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check3" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">송풍 모터</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check4" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check4" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check4" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">증발기 코일</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check5" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check5" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check5" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">고압 센서</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check6" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check6" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check6" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">저압 센서</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check7" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check7" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check7" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                    
                    <div class="grid grid-cols-2 gap-2 sm:gap-4 items-center border-b last:border-b-0 py-1">
                        <label class="text-sm font-medium text-gray-700">캐패시터</label>
                        <div class="flex space-x-2 sm:space-x-4 justify-end">
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check8" value="양호" class="form-radio text-blue-600">
                                    <span class="ml-1">양호</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check8" value="불량" class="form-radio text-blue-600">
                                    <span class="ml-1">불량</span>
                                </label>
                            
                                <label class="inline-flex items-center text-xs sm:text-sm whitespace-nowrap">
                                    <input type="radio" name="check8" value="재점검 요망" class="form-radio text-blue-600">
                                    <span class="ml-1">재점검 요망</span>
                                </label>
                            
                        </div>
                    </div>

                </div>

                <h3 class="text-base font-semibold text-gray-700 border-t pt-4 mt-4">컴프레서 1 측정값 (PSI, ℉, Amps)</h3>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">고압값 (HP, PSI)</label>
                        <input type="number" name="comp1Hp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">저압값 (LP, PSI)</label>
                        <input type="number" name="comp1Lp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">암페어 (Amps)</label>
                        <input type="number" name="comp1Amp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                </div>

                <h3 class="text-base font-semibold text-gray-700 border-t pt-4 mt-4">컴프레서 2 측정값 (선택 사항)</h3>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">고압값 (HP, PSI)</label>
                        <input type="number" name="comp2Hp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">저압값 (LP, PSI)</label>
                        <input type="number" name="comp2Lp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">암페어 (Amps)</label>
                        <input type="number" name="comp2Amp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                </div>

                <h3 class="text-base font-semibold text-gray-700 border-t pt-4 mt-4">온도 측정 (℉)</h3>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">과열도 (Superheat, ℉)</label>
                        <input type="number" name="superheat" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">과냉도 (Subcool, ℉)</label>
                        <input type="number" name="subcool" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">증발 온도 (Evaporation, ℉)</label>
                        <input type="number" name="evapTemp" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" step="0.1">
                    </div>
                </div>

                <div>
                    <label for="inspection-result" class="block text-sm font-medium text-gray-700">최종 점검 결과</label>
                    <select id="inspection-result" name="result" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                        <option value="정상">정상</option>
                        <option value="주의">주의</option>
                        <option value="수리 필요">수리 필요</option>
                    </select>
                </div>
                <div>
                    <label for="inspection-notes" class="block text-sm font-medium text-gray-700">상세 특이사항</label>
                    <textarea id="inspection-notes" name="notes" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border"></textarea>
                </div>

                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-150 shadow-md">점검 정보 저장</button>
            </form>

            <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">등록된 점검 목록 (<span id="inspection-count">0</span>건)</h2>
            <div id="inspection-list" class="space-y-4">
                </div>
        </div>

        <div id="repair-manage" class="tab-page hidden">
            <form id="repair-form" class="bg-gray-50 p-4 rounded-lg shadow-inner mb-6 space-y-4">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">RTU 수리 등록</h2>
                <div>
                    <label for="repair-rtu-id" class="block text-sm font-medium text-gray-700">대상 RTU *</label>
                    <select id="repair-rtu-id" name="rtuId" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                        <option value="">-- RTU를 선택하세요 --</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="repair-date" class="block text-sm font-medium text-gray-700">수리 요청/완료 날짜 *</label>
                        <input type="date" id="repair-date" name="repairDate" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="repair-engineer" class="block text-sm font-medium text-gray-700">수리 담당자 *</label>
                        <input type="text" id="repair-engineer" name="engineer" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                    </div>
                </div>
                <div>
                    <label for="repair-issue" class="block text-sm font-medium text-gray-700">발생 문제 및 조치 내용 *</label>
                    <textarea id="repair-issue" name="issue" rows="2" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border"></textarea>
                </div>
                <div>
                    <label for="repair-status" class="block text-sm font-medium text-gray-700">처리 상태 *</label>
                    <select id="repair-status" name="status" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                        <option value="요청">요청 (미처리)</option>
                        <option value="진행중">진행 중</option>
                        <option value="완료">완료</option>
                    </select>
                </div>

                <button type="submit" class="w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition duration-150 shadow-md">수리 정보 저장</button>
            </form>

            <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">등록된 수리 목록 (<span id="repair-count">0</span>건)</h2>
            <div id="repair-list" class="space-y-4">
                </div>
        </div>

        <div id="report-page" class="tab-page hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">보고서 생성 및 통계</h2>
            <div class="bg-gray-100 p-6 rounded-lg text-gray-600">
                <p class="mb-3">이 페이지는 현재 저장된 장비, 점검, 수리 데이터를 기반으로 월별/연도별 현황 및 분석 보고서를 출력하는 기능을 구현할 수 있습니다.</p>
                <h3 class="font-bold mt-4">데이터 현황</h3>
                <ul class="list-disc list-inside ml-4">
                    <li>총 등록 장비: <span id="report-total-rtu" class="font-semibold">0</span>대</li>
                    <li>총 점검 기록: <span id="report-total-inspection" class="font-semibold">0</span>건</li>
                    <li>총 수리 기록: <span id="report-total-repair" class="font-semibold">0</span>건</li>
                </ul>
            </div>
            
            <h3 class="font-bold text-xl text-gray-800 mt-6 border-t pt-4">데이터 다운로드 (CSV)</h3>
            <p class="text-sm text-gray-600 mb-3">저장된 RTU, 점검, 수리 데이터를 엑셀 등에서 열어볼 수 있도록 CSV 파일로 다운로드합니다. (사진 파일 제외)</p>
            <button id="download-data-btn" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md w-full">
                RTU, 점검, 수리 데이터 CSV로 다운로드
            </button>
        </div>

      </div>
      
    </div>
  </div>

  <div id="detail-modal" class="modal-bg fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl p-6 max-w-lg w-full shadow-2xl overflow-y-auto max-h-[90vh]">
      <h3 id="modal-title" class="text-2xl font-bold mb-4 border-b pb-2">상세 정보</h3>
      <div id="modal-content" class="space-y-3 text-gray-700">
        </div>
      <div class="mt-6 flex justify-end">
        <button id="close-modal-btn" class="bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-150">닫기</button>
      </div>
    </div>
  </div>

  <script>
    /* ============================
       로컬 저장소 및 데이터 구조
       ============================ */
    const STORAGE_KEYS = {
        RTU: 'rtuList',
        INSPECTION: 'inspectionList',
        REPAIR: 'repairList'
    };

    let rtuList = loadList(STORAGE_KEYS.RTU);
    let inspectionList = loadList(STORAGE_KEYS.INSPECTION);
    let repairList = loadList(STORAGE_KEYS.REPAIR);
    
    // 장비 등록 모드 상태 관리
    let rtuMode = 'new'; // 'new' 또는 'modify'
    let currentRtuIdForModification = null; // 수정 중인 RTU의 ID

    // 점검 항목 레이블
    const INSPECTION_CHECK_LABELS = [
        '필터', '콘텍터', '콘덴싱 코일', '송풍 모터', '증발기 코일', '고압 센서', '저압 센서', '캐패시터'
    ];

    function loadList(key) {
        try {
            const json = localStorage.getItem(key);
            return json ? JSON.parse(json) : [];
        } catch (e) {
            console.error(`로컬 저장소 (${key}) 로드 실패`, e);
            return [];
        }
    }

    function saveList(key, list) {
        try {
            localStorage.setItem(key, JSON.stringify(list));
        } catch (e) {
            console.error(`로컬 저장소 (${key}) 저장 실패`, e);
            alert("데이터 저장에 실패했습니다. 브라우저 저장 공간이 부족할 수 있습니다.");
        }
    }

    /* ============================
       UI 요소 및 이벤트 핸들러 초기화
       ============================ */

    const elements = {
        rtuForm: document.getElementById('rtu-form'),
        inspectionForm: document.getElementById('inspection-form'),
        repairForm: document.getElementById('repair-form'),
        imagePreviewContainer: document.getElementById('image-preview-container'),
        detailModal: document.getElementById('detail-modal'),
        tabButtons: document.querySelectorAll('.tab-btn'),
        inspectionRtuSelect: document.getElementById('inspection-rtu-id'),
        repairRtuSelect: document.getElementById('repair-rtu-id'),
        rtuList: document.getElementById('rtu-list'),
        inspectionList: document.getElementById('inspection-list'),
        repairList: document.getElementById('repair-list'),
        rtuCountSpan: document.getElementById('rtu-count'),
        inspectionCountSpan: document.getElementById('inspection-count'),
        repairCountSpan: document.getElementById('repair-count'),
        // Dashboard Elements
        dashboardTotal: document.getElementById('dashboard-total'),
        dashboardRunning: document.getElementById('dashboard-running'),
        dashboardStopped: document.getElementById('dashboard-stopped'),
        dashboardNeedsInspection: document.getElementById('dashboard-needs-inspection'),
        dashboardMonthlyInspection: document.getElementById('dashboard-monthly-inspection'),
        dashboardPendingRepair: document.getElementById('dashboard-pending-repair'),
        dashboardLatestList: document.getElementById('dashboard-latest-list'),
        // Report Elements
        reportTotalRtu: document.getElementById('report-total-rtu'),
        reportTotalInspection: document.getElementById('report-total-inspection'),
        reportTotalRepair: document.getElementById('report-total-repair'),
        downloadDataBtn: document.getElementById('download-data-btn'),
        closeModalBtn: document.getElementById('close-modal-btn'),
        // RTU Mode Elements (신규/수정 분리 추가)
        modeNewBtn: document.getElementById('mode-new-btn'),
        modeModifyBtn: document.getElementById('mode-modify-btn'),
        rtuIdContainer: document.getElementById('rtu-id-container'),
        rtuFormTitle: document.getElementById('rtu-form-title'),
        rtuIdInputForMod: document.getElementById('rtu-id-for-modification'),
        rtuSubmitBtn: document.getElementById('rtu-submit-btn')
    };

    let currentModalData = { id: null, type: null };

    // --- 탭 전환 로직 ---
    elements.tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.dataset.tab;

            // 버튼 스타일 변경
            elements.tabButtons.forEach(btn => btn.classList.remove('tab-active', 'border-blue-500'));
            button.classList.add('tab-active', 'border-blue-500');

            // 페이지 컨텐츠 전환
            document.querySelectorAll('.tab-page').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(targetTab).classList.remove('hidden');

            // 탭에 따른 데이터 갱신
            if (targetTab === 'dashboard') {
                updateDashboard();
            } else if (targetTab === 'rtu-manage') {
                switchRtuMode(rtuMode); // 모드 상태 유지하면서 UI 갱신 (목록 포함)
                renderRtuList();
            } else if (targetTab === 'inspection-manage') {
                populateRtuSelects();
                renderInspectionList();
            } else if (targetTab === 'repair-manage') {
                populateRtuSelects();
                renderRepairList();
            } else if (targetTab === 'report-page') {
                updateReportPage();
            }
        });
    });

    // --- RTU 모드 전환 함수 (핵심 개선) ---
    window.switchRtuMode = function(mode, targetRtuId = null) {
        rtuMode = mode;
        currentRtuIdForModification = targetRtuId;

        // 버튼 스타일 업데이트
        elements.modeNewBtn.classList.remove('bg-blue-600', 'text-white', 'bg-gray-200', 'text-gray-700');
        elements.modeModifyBtn.classList.remove('bg-blue-600', 'text-white', 'bg-gray-200', 'text-gray-700');

        if (mode === 'new') {
            elements.modeNewBtn.classList.add('bg-blue-600', 'text-white');
            elements.modeModifyBtn.classList.add('bg-gray-200', 'text-gray-700');
            elements.rtuFormTitle.textContent = 'RTU 장비 신규 등록';
            elements.rtuSubmitBtn.textContent = 'RTU 정보 저장';
            
            // 신규 등록 폼으로 변경: RTU 등록번호 직접 입력
            elements.rtuIdContainer.innerHTML = `
                <div>
                    <label for="rtu-name" class="block text-sm font-medium text-gray-700">RTU 등록번호/ID *</label>
                    <input type="text" id="rtu-name" name="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                </div>
            `;
            elements.rtuIdInputForMod.value = '';
            elements.rtuForm.reset();
            clearImagePreviews();

        } else { // modify
            elements.modeModifyBtn.classList.add('bg-blue-600', 'text-white');
            elements.modeNewBtn.classList.add('bg-gray-200', 'text-gray-700');
            elements.rtuFormTitle.textContent = 'RTU 장비 정보 수정';
            elements.rtuSubmitBtn.textContent = 'RTU 정보 수정 및 저장';

            // 수정 폼으로 변경: RTU 선택 드롭다운
            elements.rtuIdContainer.innerHTML = `
                <div>
                    <label for="rtu-select-modify" class="block text-sm font-medium text-gray-700">수정할 RTU 등록번호/ID *</label>
                    <select id="rtu-select-modify" name="rtuSelect" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border focus:ring-blue-500">
                        <option value="">-- RTU를 선택하세요 --</option>
                    </select>
                </div>
            `;

            // 드롭다운 채우기 및 이벤트 리스너 설정
            populateRtuSelectForModification();
            const rtuSelectModify = document.getElementById('rtu-select-modify');
            rtuSelectModify.addEventListener('change', (e) => {
                loadRtuForModification(e.target.value);
            });

            if (targetRtuId) {
                // 모달에서 수정 버튼을 눌러 ID가 전달된 경우
                rtuSelectModify.value = targetRtuId;
                loadRtuForModification(targetRtuId);
            } else {
                elements.rtuForm.reset();
                clearImagePreviews();
            }
        }
    }

    function populateRtuSelectForModification() {
        const select = document.getElementById('rtu-select-modify');
        if (!select) return;

        select.innerHTML = '<option value="">-- RTU를 선택하세요 --</option>';

        rtuList.forEach(rtu => {
            const option = document.createElement('option');
            option.value = rtu.id;
            option.textContent = rtu.name;
            select.appendChild(option);
        });
    }
    
    function loadRtuForModification(rtuId) {
        const rtu = rtuList.find(r => r.id === rtuId);
        if (!rtu) {
            elements.rtuForm.reset();
            clearImagePreviews();
            elements.rtuIdInputForMod.value = '';
            return;
        }

        elements.rtuIdInputForMod.value = rtu.id; // 실제 수정할 RTU의 ID 저장 (hidden input)
        document.getElementById('rtu-name')?.value = rtu.name || ''; // 신규 모드에서만 사용되지만 안전을 위해 처리
        document.getElementById('rtu-region').value = rtu.region || '';
        document.getElementById('rtu-model').value = rtu.model || '';
        document.getElementById('rtu-capacity').value = rtu.capacity || '';
        document.getElementById('rtu-unit-type').value = rtu.unitType || '';
        document.getElementById('rtu-refrigerant').value = rtu.refrigerant || '';
        document.getElementById('rtu-status').value = rtu.status || '작동중';
        document.getElementById('rtu-electric-phase').value = rtu.electricPhase || '단상';
        document.getElementById('rtu-date').value = rtu.date || '';
        document.getElementById('rtu-pressure-high').value = rtu.pressureHighLimit || '';
        document.getElementById('rtu-pressure-low').value = rtu.pressureLowLimit || '';
        document.getElementById('rtu-notes').value = rtu.notes || '';
        
        // 이미지 미리보기 로드
        clearImagePreviews();
        ['image1', 'image2', 'image3'].forEach((key, index) => {
            if (rtu[key] && rtu[key].startsWith('data:')) {
                const imgElement = document.getElementById(`image-preview-${index + 1}`);
                imgElement.src = rtu[key];
                elements.imagePreviewContainer.classList.remove('hidden');
            }
        });
    }

    // --- 파일 미리보기 로직 ---
    window.previewImage = function(event, index) {
        const reader = new FileReader();
        reader.onload = function(){
            const output = document.getElementById(`image-preview-${index}`);
            output.src = reader.result;
            elements.imagePreviewContainer.classList.remove('hidden');
        };
        if (event.target.files[0]) {
            reader.readAsDataURL(event.target.files[0]);
        }
    }

    function clearImagePreviews() {
        ['image-preview-1', 'image-preview-2', 'image-preview-3'].forEach(id => {
            const img = document.getElementById(id);
            if (img) img.src = '';
        });
        elements.imagePreviewContainer.classList.add('hidden');
    }

    // --- RTU 폼 제출 로직 ---
    elements.rtuForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const form = e.target;
        const formData = new FormData(form);
        const rtuData = {};
        let isNewRtu = rtuMode === 'new';
        let rtuId = elements.rtuIdInputForMod.value || null;

        if (isNewRtu) {
            const nameInput = document.getElementById('rtu-name').value.trim();
            if (!nameInput) {
                alert("RTU 등록번호/ID를 입력해주세요.");
                return;
            }
            // 신규 등록 시 ID 중복 확인
            if (rtuList.some(rtu => rtu.name === nameInput)) {
                alert(`RTU 등록번호/ID '${nameInput}'는 이미 존재합니다. 다른 ID를 사용해주세요.`);
                return;
            }
            rtuId = Date.now().toString(); // 신규 ID 생성
            rtuData.name = nameInput;
        } else {
            // 수정 모드에서는 선택된 RTU ID를 사용하고, name은 기존 값을 유지하거나 수정되지 않음
            const selectedName = document.getElementById('rtu-select-modify')?.options[document.getElementById('rtu-select-modify').selectedIndex]?.text;
            if (!rtuId) {
                alert("수정할 RTU를 선택해주세요.");
                return;
            }
            rtuData.name = selectedName;
        }

        rtuData.id = rtuId;
        rtuData.createdAt = rtuList.find(r => r.id === rtuId)?.createdAt || new Date().toISOString(); // 생성 시간 유지
        rtuData.updatedAt = new Date().toISOString(); // 업데이트 시간 기록

        // 나머지 필드 처리
        rtuData.region = formData.get('region');
        rtuData.model = formData.get('model');
        rtuData.capacity = formData.get('capacity');
        rtuData.unitType = formData.get('unitType');
        rtuData.refrigerant = formData.get('refrigerant');
        rtuData.status = formData.get('status');
        rtuData.electricPhase = formData.get('electricPhase');
        rtuData.date = formData.get('date');
        rtuData.pressureHighLimit = formData.get('pressureHighLimit');
        rtuData.pressureLowLimit = formData.get('pressureLowLimit');
        rtuData.notes = formData.get('notes');

        // 이미지 파일 처리 (Data URL로 저장)
        for (let i = 1; i <= 3; i++) {
            const file = formData.get(`image${i}`);
            const key = `image${i}`;
            
            if (file && file.size > 0) {
                // 새 파일이 업로드된 경우
                rtuData[key] = await fileToBase64(file);
            } else if (!isNewRtu) {
                // 수정 모드이고 새 파일이 없는 경우: 기존 파일 데이터 유지 (URL이 아닌 Data URL 문자열일 경우)
                const existingRtu = rtuList.find(r => r.id === rtuId);
                if (existingRtu && existingRtu[key] && existingRtu[key].startsWith('data:')) {
                    rtuData[key] = existingRtu[key];
                } else {
                    rtuData[key] = '';
                }
            } else {
                rtuData[key] = '';
            }
        }
        
        // 목록 업데이트
        if (isNewRtu) {
            rtuList.push(rtuData);
            alert(`RTU 장비 '${rtuData.name}'가 성공적으로 등록되었습니다.`);
        } else {
            const index = rtuList.findIndex(r => r.id === rtuId);
            if (index !== -1) {
                // 기존 RTU의 모든 속성을 새 데이터로 교체
                rtuList[index] = { ...rtuList[index], ...rtuData }; 
                alert(`RTU 장비 '${rtuData.name}' 정보가 성공적으로 수정되었습니다.`);
            }
        }

        saveList(STORAGE_KEYS.RTU, rtuList);
        form.reset();
        clearImagePreviews();
        switchRtuMode('new'); // 다시 신규 등록 모드로 전환
        renderRtuList();
        populateRtuSelects(); // 다른 폼의 드롭다운 업데이트
    });

    // File 객체를 Base64 Data URL 문자열로 변환
    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }

    // --- RTU 목록 렌더링 ---
    function renderRtuList() {
        elements.rtuList.innerHTML = '';
        elements.rtuCountSpan.textContent = rtuList.length;

        if (rtuList.length === 0) {
            elements.rtuList.innerHTML = '<p class="text-gray-500 italic p-4 border rounded-lg">등록된 RTU 장비가 없습니다.</p>';
            return;
        }

        rtuList.sort((a, b) => a.name.localeCompare(b.name, 'ko')); // 이름 순으로 정렬

        rtuList.forEach(rtu => {
            const listItem = document.createElement('div');
            listItem.className = 'flex items-center justify-between bg-white p-4 border rounded-lg shadow-sm';
            listItem.innerHTML = `
                <div class="flex-1 min-w-0 mr-4">
                    <p class="text-lg font-semibold text-gray-800 truncate">${rtu.name}</p>
                    <p class="text-sm text-gray-500">${rtu.region || '지역 미지정'} | ${rtu.model || '모델 미상'}</p>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="px-3 py-1 text-sm font-medium rounded-full ${getStatusClass(rtu.status)}">${rtu.status}</span>
                    <button data-id="${rtu.id}" data-type="rtu" class="detail-btn bg-blue-100 text-blue-700 hover:bg-blue-200 text-sm font-medium py-1 px-3 rounded-full transition duration-150">상세</button>
                    <button data-id="${rtu.id}" class="modify-rtu-btn bg-yellow-100 text-yellow-700 hover:bg-yellow-200 text-sm font-medium py-1 px-3 rounded-full transition duration-150">수정</button>
                    <button data-id="${rtu.id}" class="delete-rtu-btn bg-red-100 text-red-700 hover:bg-red-200 text-sm font-medium py-1 px-3 rounded-full transition duration-150">삭제</button>
                </div>
            `;
            elements.rtuList.appendChild(listItem);
        });

        // 이벤트 리스너 재할당
        document.querySelectorAll('.detail-btn').forEach(btn => btn.addEventListener('click', handleDetailClick));
        document.querySelectorAll('.modify-rtu-btn').forEach(btn => btn.addEventListener('click', handleRtuModifyClick));
        document.querySelectorAll('.delete-rtu-btn').forEach(btn => btn.addEventListener('click', handleRtuDeleteClick));
    }

    function getStatusClass(status) {
        switch (status) {
            case '작동중': return 'bg-green-100 text-green-800';
            case '정지됨': return 'bg-gray-100 text-gray-800';
            case '점검필요': return 'bg-red-100 text-red-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    }

    function getRepairStatusClass(status) {
        switch (status) {
            case '완료': return 'bg-green-100 text-green-800';
            case '진행중': return 'bg-yellow-100 text-yellow-800';
            case '요청': return 'bg-red-100 text-red-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    }

    // --- RTU 수정 버튼 클릭 핸들러 ---
    function handleRtuModifyClick(e) {
        const rtuId = e.target.dataset.id;
        // 장비 관리 탭으로 이동하고 수정 모드로 전환
        const rtuManageTab = document.querySelector('button[data-tab="rtu-manage"]');
        rtuManageTab.click(); 
        switchRtuMode('modify', rtuId);
    }

    // --- RTU 삭제 버튼 클릭 핸들러 ---
    function handleRtuDeleteClick(e) {
        const rtuId = e.target.dataset.id;
        const rtu = rtuList.find(r => r.id === rtuId);

        if (confirm(`RTU 장비 '${rtu.name}'를 정말 삭제하시겠습니까? 관련 점검 및 수리 기록도 함께 삭제됩니다.`)) {
            // RTU 삭제
            rtuList = rtuList.filter(r => r.id !== rtuId);
            saveList(STORAGE_KEYS.RTU, rtuList);

            // 연관된 점검/수리 기록 삭제
            inspectionList = inspectionList.filter(i => i.rtuId !== rtuId);
            saveList(STORAGE_KEYS.INSPECTION, inspectionList);
            repairList = repairList.filter(r => r.rtuId !== rtuId);
            saveList(STORAGE_KEYS.REPAIR, repairList);

            renderRtuList();
            populateRtuSelects(); // 드롭다운 목록 업데이트
            alert(`RTU 장비 '${rtu.name}' 및 관련 기록이 삭제되었습니다.`);
        }
    }

    // --- 점검 폼 제출 로직 ---
    elements.inspectionForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const form = e.target;
        const formData = new FormData(form);
        const inspectionData = {
            id: Date.now().toString(),
            createdAt: new Date().toISOString(),
            rtuId: formData.get('rtuId'),
            inspectionDate: formData.get('inspectionDate'),
            inspector: formData.get('inspector'),
            result: formData.get('result'),
            notes: formData.get('notes'),
            checks: {},
            measurements: {
                comp1Hp: formData.get('comp1Hp'),
                comp1Lp: formData.get('comp1Lp'),
                comp1Amp: formData.get('comp1Amp'),
                comp2Hp: formData.get('comp2Hp'),
                comp2Lp: formData.get('comp2Lp'),
                comp2Amp: formData.get('comp2Amp'),
                superheat: formData.get('superheat'),
                subcool: formData.get('subcool'),
                evapTemp: formData.get('evapTemp'),
            }
        };

        // 부품 체크 결과 저장
        for (let i = 1; i <= INSPECTION_CHECK_LABELS.length; i++) {
            const checkName = `check${i}`;
            inspectionData.checks[INSPECTION_CHECK_LABELS[i-1]] = formData.get(checkName) || '미점검';
        }

        inspectionList.push(inspectionData);
        saveList(STORAGE_KEYS.INSPECTION, inspectionList);
        form.reset();
        renderInspectionList();
        
        // RTU 상태 업데이트 (점검 결과에 따라)
        const rtu = rtuList.find(r => r.id === inspectionData.rtuId);
        if (rtu) {
            if (inspectionData.result === '정상') {
                rtu.status = '작동중';
            } else if (inspectionData.result === '수리 필요') {
                rtu.status = '점검필요'; // 수리가 필요한 경우 점검 필요 상태로 변경
            }
            saveList(STORAGE_KEYS.RTU, rtuList);
            renderRtuList(); // RTU 목록 UI도 업데이트
        }
        
        alert("점검 정보가 성공적으로 등록되었습니다.");
    });

    // --- 점검 목록 렌더링 ---
    function renderInspectionList() {
        elements.inspectionList.innerHTML = '';
        elements.inspectionCountSpan.textContent = inspectionList.length;

        if (inspectionList.length === 0) {
            elements.inspectionList.innerHTML = '<p class="text-gray-500 italic p-4 border rounded-lg">등록된 점검 기록이 없습니다.</p>';
            return;
        }

        inspectionList.sort((a, b) => new Date(b.inspectionDate) - new Date(a.inspectionDate)); // 날짜 역순 정렬

        inspectionList.forEach(inspection => {
            const rtu = rtuList.find(r => r.id === inspection.rtuId);
            const rtuName = rtu ? rtu.name : '알 수 없는 RTU';
            
            const listItem = document.createElement('div');
            listItem.className = 'flex items-center justify-between bg-white p-4 border rounded-lg shadow-sm';
            listItem.innerHTML = `
                <div class="flex-1 min-w-0 mr-4">
                    <p class="text-lg font-semibold text-gray-800 truncate">${rtuName} (${inspection.inspectionDate})</p>
                    <p class="text-sm text-gray-500">점검자: ${inspection.inspector}</p>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="px-3 py-1 text-sm font-medium rounded-full ${getStatusClassForInspection(inspection.result)}">${inspection.result}</span>
                    <button data-id="${inspection.id}" data-type="inspection" class="detail-btn bg-blue-100 text-blue-700 hover:bg-blue-200 text-sm font-medium py-1 px-3 rounded-full transition duration-150">상세</button>
                    <button data-id="${inspection.id}" class="delete-inspection-btn bg-red-100 text-red-700 hover:bg-red-200 text-sm font-medium py-1 px-3 rounded-full transition duration-150">삭제</button>
                </div>
            `;
            elements.inspectionList.appendChild(listItem);
        });

        document.querySelectorAll('.detail-btn').forEach(btn => btn.addEventListener('click', handleDetailClick));
        document.querySelectorAll('.delete-inspection-btn').forEach(btn => btn.addEventListener('click', handleInspectionDeleteClick));
    }

    function getStatusClassForInspection(result) {
        switch (result) {
            case '정상': return 'bg-green-100 text-green-800';
            case '주의': return 'bg-yellow-100 text-yellow-800';
            case '수리 필요': return 'bg-red-100 text-red-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    }

    // --- 점검 기록 삭제 핸들러 ---
    function handleInspectionDeleteClick(e) {
        const inspectionId = e.target.dataset.id;
        const inspection = inspectionList.find(i => i.id === inspectionId);

        if (confirm(`해당 점검 기록을 정말 삭제하시겠습니까?`)) {
            inspectionList = inspectionList.filter(i => i.id !== inspectionId);
            saveList(STORAGE_KEYS.INSPECTION, inspectionList);
            renderInspectionList();
            alert("점검 기록이 삭제되었습니다.");
        }
    }

    // --- 수리 폼 제출 로직 ---
    elements.repairForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const form = e.target;
        const formData = new FormData(form);
        const repairData = {
            id: Date.now().toString(),
            createdAt: new Date().toISOString(),
            rtuId: formData.get('rtuId'),
            repairDate: formData.get('repairDate'),
            engineer: formData.get('engineer'),
            issue: formData.get('issue'),
            status: formData.get('status')
        };

        repairList.push(repairData);
        saveList(STORAGE_KEYS.REPAIR, repairList);
        form.reset();
        renderRepairList();
        
        // RTU 상태 업데이트 (수리 완료 시)
        const rtu = rtuList.find(r => r.id === repairData.rtuId);
        if (rtu && repairData.status === '완료') {
            rtu.status = '작동중';
            saveList(STORAGE_KEYS.RTU, rtuList);
            renderRtuList(); // RTU 목록 UI도 업데이트
        }

        alert("수리 정보가 성공적으로 등록되었습니다.");
    });

    // --- 수리 목록 렌더링 ---
    function renderRepairList() {
        elements.repairList.innerHTML = '';
        elements.repairCountSpan.textContent = repairList.length;

        if (repairList.length === 0) {
            elements.repairList.innerHTML = '<p class="text-gray-500 italic p-4 border rounded-lg">등록된 수리 기록이 없습니다.</p>';
            return;
        }

        repairList.sort((a, b) => new Date(b.repairDate) - new Date(a.repairDate)); // 날짜 역순 정렬

        repairList.forEach(repair => {
            const rtu = rtuList.find(r => r.id === repair.rtuId);
            const rtuName = rtu ? rtu.name : '알 수 없는 RTU';
            
            const listItem = document.createElement('div');
            listItem.className = 'flex items-center justify-between bg-white p-4 border rounded-lg shadow-sm';
            listItem.innerHTML = `
                <div class="flex-1 min-w-0 mr-4">
                    <p class="text-lg font-semibold text-gray-800 truncate">${rtuName} (${repair.repairDate})</p>
                    <p class="text-sm text-gray-500 truncate">조치: ${repair.issue}</p>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="px-3 py-1 text-sm font-medium rounded-full ${getRepairStatusClass(repair.status)}">${repair.status}</span>
                    <button data-id="${repair.id}" data-type="repair" class="detail-btn bg-blue-100 text-blue-700 hover:bg-blue-200 text-sm font-medium py-1 px-3 rounded-full transition duration-150">상세</button>
                    <button data-id="${repair.id}" class="delete-repair-btn bg-red-100 text-red-700 hover:bg-red-200 text-sm font-medium py-1 px-3 rounded-full transition duration-150">삭제</button>
                </div>
            `;
            elements.repairList.appendChild(listItem);
        });

        document.querySelectorAll('.detail-btn').forEach(btn => btn.addEventListener('click', handleDetailClick));
        document.querySelectorAll('.delete-repair-btn').forEach(btn => btn.addEventListener('click', handleRepairDeleteClick));
    }

    // --- 수리 기록 삭제 핸들러 ---
    function handleRepairDeleteClick(e) {
        const repairId = e.target.dataset.id;
        const repair = repairList.find(r => r.id === repairId);

        if (confirm(`해당 수리 기록을 정말 삭제하시겠습니까?`)) {
            repairList = repairList.filter(r => r.id !== repairId);
            saveList(STORAGE_KEYS.REPAIR, repairList);
            renderRepairList();
            alert("수리 기록이 삭제되었습니다.");
        }
    }

    // --- RTU 선택 드롭다운 채우기 (점검/수리 폼) ---
    function populateRtuSelects() {
        const optionsHtml = rtuList.map(rtu => `<option value="${rtu.id}">${rtu.name}</option>`).join('');
        
        elements.inspectionRtuSelect.innerHTML = '<option value="">-- RTU를 선택하세요 --</option>' + optionsHtml;
        elements.repairRtuSelect.innerHTML = '<option value="">-- RTU를 선택하세요 --</option>' + optionsHtml;
    }

    // --- 상세 정보 모달 처리 ---
    function handleDetailClick(e) {
        const id = e.target.dataset.id;
        const type = e.target.dataset.type;
        let data, title, contentHtml;

        if (type === 'rtu') {
            data = rtuList.find(r => r.id === id);
            title = `RTU 상세 정보: ${data.name}`;
            contentHtml = generateRtuDetailHtml(data);
        } else if (type === 'inspection') {
            data = inspectionList.find(i => i.id === id);
            const rtu = rtuList.find(r => r.id === data.rtuId);
            title = `점검 기록 상세 정보: ${rtu ? rtu.name : '알 수 없음'}`;
            contentHtml = generateInspectionDetailHtml(data, rtu);
        } else if (type === 'repair') {
            data = repairList.find(r => r.id === id);
            const rtu = rtuList.find(r => r.id === data.rtuId);
            title = `수리 기록 상세 정보: ${rtu ? rtu.name : '알 수 없음'}`;
            contentHtml = generateRepairDetailHtml(data, rtu);
        } else {
            return;
        }

        currentModalData = { id, type };
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-content').innerHTML = contentHtml;
        elements.detailModal.classList.remove('hidden');
    }

    function generateRtuDetailHtml(rtu) {
        const imagesHtml = ['image1', 'image2', 'image3'].map(key => {
            if (rtu[key] && rtu[key].startsWith('data:')) {
                return `<img src="${rtu[key]}" class="thumb" alt="RTU 사진">`;
            }
            return '';
        }).join('');

        const relatedData = getRelatedData(rtu.id);
        const latestInspection = relatedData.inspections.length > 0 ? relatedData.inspections[0].inspectionDate : '없음';
        const latestRepair = relatedData.repairs.length > 0 ? relatedData.repairs[0].repairDate : '없음';

        return `
            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                <p class="font-bold">등록번호/ID:</p><p>${rtu.name}</p>
                <p class="font-bold">현재 상태:</p><p><span class="px-3 py-1 text-sm font-medium rounded-full ${getStatusClass(rtu.status)}">${rtu.status}</span></p>
                <p class="font-bold">설치 날짜:</p><p>${rtu.date || '미정'}</p>
                <p class="font-bold">설치 지역:</p><p>${rtu.region || '미정'}</p>
                <p class="font-bold">모델/용량:</p><p>${rtu.model || '미상'} / ${rtu.capacity || '미상'}</p>
                <p class="font-bold">고압/저압 제한:</p><p>${rtu.pressureHighLimit || '미정'} PSI / ${rtu.pressureLowLimit || '미정'} PSI</p>
            </div>
            <div class="mt-4 border-t pt-3">
                <p class="font-bold mb-1">최근 활동:</p>
                <p>총 점검 기록: ${relatedData.inspections.length}건 (최근: ${latestInspection})</p>
                <p>총 수리 기록: ${relatedData.repairs.length}건 (최근: ${latestRepair})</p>
            </div>
            <div class="mt-4 border-t pt-3">
                <p class="font-bold mb-1">사진:</p>
                <div class="flex gap-2 flex-wrap">${imagesHtml || '<p class="text-gray-500 italic">등록된 사진 없음</p>'}</div>
            </div>
            <div class="mt-4 border-t pt-3">
                <p class="font-bold mb-1">기타 메모:</p>
                <p class="whitespace-pre-wrap">${rtu.notes || '특이사항 없음'}</p>
            </div>
            <div class="mt-4 border-t pt-3">
                <button onclick="handleDetailActionClick('modify')" class="bg-yellow-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-yellow-600 transition duration-150 mr-2">장비 수정</button>
                <button onclick="handleDetailActionClick('delete')" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition duration-150">장비 삭제</button>
            </div>
        `;
    }

    function generateInspectionDetailHtml(inspection, rtu) {
        const checksHtml = Object.entries(inspection.checks).map(([key, value]) => 
            `<p class="font-bold">${key}:</p><p class="${getStatusClassForInspection(value)} px-2 rounded-full">${value}</p>`
        ).join('');
        
        return `
            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                <p class="font-bold">대상 RTU:</p><p>${rtu ? rtu.name : '알 수 없음'}</p>
                <p class="font-bold">점검 날짜:</p><p>${inspection.inspectionDate}</p>
                <p class="font-bold">점검자:</p><p>${inspection.inspector}</p>
                <p class="font-bold">최종 결과:</p><p><span class="${getStatusClassForInspection(inspection.result)} px-2 rounded-full">${inspection.result}</span></p>
            </div>
            <div class="mt-4 border-t pt-3">
                <p class="font-bold mb-1">부품 점검 결과:</p>
                <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">${checksHtml}</div>
            </div>
            <div class="mt-4 border-t pt-3">
                <p class="font-bold mb-1">측정값:</p>
                <div class="grid grid-cols-3 gap-2 text-sm">
                    <p class="font-bold">Comp 1 HP:</p><p>${inspection.measurements.comp1Hp || '-'}</p>
                    <p class="font-bold">Comp 1 LP:</p><p>${inspection.measurements.comp1Lp || '-'}</p>
                    <p class="font-bold">Comp 1 Amp:</p><p>${inspection.measurements.comp1Amp || '-'}</p>
                    <p class="font-bold">Superheat:</p><p>${inspection.measurements.superheat || '-'}</p>
                    <p class="font-bold">Subcool:</p><p>${inspection.measurements.subcool || '-'}</p>
                    <p class="font-bold">Evap Temp:</p><p>${inspection.measurements.evapTemp || '-'}</p>
                </div>
            </div>
            <div class="mt-4 border-t pt-3">
                <p class="font-bold mb-1">상세 특이사항:</p>
                <p class="whitespace-pre-wrap">${inspection.notes || '특이사항 없음'}</p>
            </div>
        `;
    }

    function generateRepairDetailHtml(repair, rtu) {
        return `
            <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                <p class="font-bold">대상 RTU:</p><p>${rtu ? rtu.name : '알 수 없음'}</p>
                <p class="font-bold">처리 상태:</p><p><span class="${getRepairStatusClass(repair.status)} px-2 rounded-full">${repair.status}</span></p>
                <p class="font-bold">수리 날짜:</p><p>${repair.repairDate}</p>
                <p class="font-bold">담당자:</p><p>${repair.engineer}</p>
            </div>
            <div class="mt-4 border-t pt-3">
                <p class="font-bold mb-1">발생 문제 및 조치 내용:</p>
                <p class="whitespace-pre-wrap">${repair.issue}</p>
            </div>
        `;
    }

    window.handleDetailActionClick = function(action) {
        elements.detailModal.classList.add('hidden'); // 모달 닫기
        
        if (action === 'modify' && currentModalData.type === 'rtu') {
            handleRtuModifyClick({ target: { dataset: { id: currentModalData.id } } });
        } else if (action === 'delete' && currentModalData.type === 'rtu') {
            handleRtuDeleteClick({ target: { dataset: { id: currentModalData.id } } });
        }
    }


    // --- 대시보드 업데이트 로직 ---
    function updateDashboard() {
        // 1. 장비 상태 요약
        const total = rtuList.length;
        const running = rtuList.filter(r => r.status === '작동중').length;
        const stopped = rtuList.filter(r => r.status === '정지됨').length;
        const needsInspection = rtuList.filter(r => r.status === '점검필요').length;

        elements.dashboardTotal.textContent = total;
        elements.dashboardRunning.textContent = running;
        elements.dashboardStopped.textContent = stopped;
        elements.dashboardNeedsInspection.textContent = needsInspection;

        // 2. 처리 현황
        const now = new Date();
        const currentMonth = now.toISOString().substring(0, 7); // YYYY-MM

        const monthlyInspection = inspectionList.filter(i => i.inspectionDate.startsWith(currentMonth)).length;
        const pendingRepair = repairList.filter(r => r.status !== '완료').length;

        elements.dashboardMonthlyInspection.textContent = monthlyInspection;
        elements.dashboardPendingRepair.textContent = pendingRepair;

        // 3. 개별 장비 상태 (최근 활동 5건)
        const recentActivities = [];

        // RTU 업데이트
        rtuList.forEach(rtu => {
            recentActivities.push({
                date: new Date(rtu.updatedAt || rtu.createdAt),
                type: '장비 정보 업데이트',
                rtuName: rtu.name,
                rtuId: rtu.id,
                details: `상태: ${rtu.status}`,
                statusClass: getStatusClass(rtu.status)
            });
        });

        // 점검 기록
        inspectionList.forEach(inspection => {
            const rtu = rtuList.find(r => r.id === inspection.rtuId);
            recentActivities.push({
                date: new Date(inspection.createdAt),
                type: '점검 완료',
                rtuName: rtu ? rtu.name : '삭제된 RTU',
                rtuId: inspection.rtuId,
                details: `결과: ${inspection.result}`,
                statusClass: getStatusClassForInspection(inspection.result)
            });
        });

        // 수리 기록
        repairList.forEach(repair => {
            const rtu = rtuList.find(r => r.id === repair.rtuId);
            recentActivities.push({
                date: new Date(repair.createdAt),
                type: `수리 기록 (${repair.status})`,
                rtuName: rtu ? rtu.name : '삭제된 RTU',
                rtuId: repair.rtuId,
                details: `담당자: ${repair.engineer}`,
                statusClass: getRepairStatusClass(repair.status)
            });
        });

        // 최신순으로 정렬하고 상위 5개만 선택
        recentActivities.sort((a, b) => b.date - a.date);
        const latestActivities = recentActivities.slice(0, 5);

        elements.dashboardLatestList.innerHTML = '';

        if (latestActivities.length === 0) {
            elements.dashboardLatestList.innerHTML = '<p class="text-gray-500 italic">최근 활동 기록이 없습니다.</p>';
            return;
        }

        latestActivities.forEach(activity => {
            const activityElement = document.createElement('div');
            activityElement.className = 'flex items-center justify-between bg-gray-50 p-3 border rounded-lg';
            
            const dateStr = activity.date.toLocaleString('ko-KR', { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit' 
            });

            activityElement.innerHTML = `
                <div class="flex-1 min-w-0 mr-4">
                    <p class="text-sm font-medium text-gray-800 truncate">${activity.rtuName}</p>
                    <p class="text-xs text-gray-500">${dateStr} | ${activity.type}</p>
                </div>
                <p class="text-sm text-gray-600">${activity.details}</p>
            `;
            elements.dashboardLatestList.appendChild(activityElement);
        });
    }


    // --- 보고서 페이지 업데이트 로직 ---
    function updateReportPage() {
        elements.reportTotalRtu.textContent = rtuList.length;
        elements.reportTotalInspection.textContent = inspectionList.length;
        elements.reportTotalRepair.textContent = repairList.length;
    }

    // --- CSV 다운로드 로직 ---
    function jsonToCsv(arr, filename) {
        if (arr.length === 0) {
            alert("다운로드할 데이터가 없습니다.");
            return;
        }
        
        // 헤더 추출 (첫 번째 객체의 키를 사용)
        const header = Object.keys(arr[0]).filter(key => !key.startsWith('image')); // 이미지 데이터 제외
        const csvRows = [];
        csvRows.push(header.join(','));

        // 데이터 행 생성
        for (const row of arr) {
            const values = header.map(fieldName => {
                const value = row[fieldName] === null || row[fieldName] === undefined ? '' : row[fieldName];
                // CSV 필드 이스케이프 처리: 쉼표, 따옴표, 줄 바꿈이 포함된 경우 큰따옴표로 묶고, 내부 큰따옴표는 두 개로 이스케이프
                const stringValue = String(value).replace(/"/g, '""');
                return /[,"\n]/.test(value) ? `"${stringValue}"` : stringValue;
            });
            csvRows.push(values.join(','));
        }

        // CSV 데이터 Blob 생성
        const csvString = csvRows.join('\n');
        // BOM (Byte Order Mark) 추가: 엑셀에서 한글 깨짐 방지
        const blob = new Blob(["\ufeff" + csvString], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        
        if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }

    function handleDataDownload() {
        try {
            // RTU 데이터 다운로드
            jsonToCsv(rtuList, 'rtu_data.csv');

            // 점검 데이터 다운로드
            const inspectionCsvData = inspectionList.map(item => {
                // 부품 체크 항목을 최상위 속성으로 평탄화
                const flatItem = { ...item, ...item.checks, ...item.measurements };
                delete flatItem.checks;
                delete flatItem.measurements;
                return flatItem;
            });
            jsonToCsv(inspectionCsvData, 'inspection_data.csv');

            // 수리 데이터 다운로드
            jsonToCsv(repairList, 'repair_data.csv');

            alert("RTU, 점검, 수리 데이터가 각각 CSV 파일로 다운로드되었습니다.");
        } catch (e) {
            console.error("다운로드 오류:", e);
            alert("데이터 다운로드 중 오류가 발생했습니다. 콘솔을 확인해주세요.");
        }
    }

    // --- 기타 유틸리티 ---
    function getRelatedData(rtuId) {
        return {
            inspections: inspectionList.filter(i => i.rtuId === rtuId).sort((a, b) => new Date(b.inspectionDate) - new Date(a.inspectionDate)),
            repairs: repairList.filter(r => r.rtuId === rtuId).sort((a, b) => new Date(b.repairDate) - new Date(a.repairDate))
        };
    }

    /* ============================
       페이지 로드 시 초기화
       ============================ */
    
    document.addEventListener('DOMContentLoaded', () => {
        
        updateDashboard();
        populateRtuSelects();
        
        // 초기 모드 설정 및 UI 렌더링
        switchRtuMode('new'); 
        renderRtuList(); 
        renderInspectionList();
        renderRepairList();
        
        // 초기 탭 설정 (대시보드를 먼저 보여줌)
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('rtu-manage').classList.add('hidden');
        document.getElementById('inspection-manage').classList.add('hidden');
        document.getElementById('repair-manage').classList.add('hidden');
        document.getElementById('report-page').classList.add('hidden');
        
        // --- 모달 이벤트 리스너 ---
        elements.closeModalBtn.addEventListener('click', (e) => { // 수정: (e) 추가
            e.stopPropagation(); // 수정: 이벤트 버블링 방지
            elements.detailModal.classList.add('hidden');
            currentModalData = { id: null, type: null };
        });

        elements.detailModal.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-bg')) {
                elements.detailModal.classList.add('hidden');
                currentModalData = { id: null, type: null };
            }
        });

        // --- 데이터 다운로드 버튼 리스너 ---
        elements.downloadDataBtn.addEventListener('click', handleDataDownload);

        console.warn("데이터는 브라우저의 localStorage에만 저장됩니다. 브라우저를 닫으면 데이터가 유실되지 않지만, 브라우저 데이터를 삭제하면 유실됩니다.");
    });
  </script>
</body>
</html>